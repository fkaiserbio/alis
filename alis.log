++ loadkeys de
+ execute_step facts
+ local STEP=facts

[0;96m# facts() step[0m

+ eval facts
++ facts
++ print_step 'facts()'
++ STEP='facts()'
++ echo ''
++ echo -e '\033[0;96m# facts() step\033[0m'
++ echo ''
++ facts_commons
++ '[' -d /sys/firmware/efi ']'
++ BIOS_TYPE=bios
++ '[' -f alis.asciinema -o -f alis-recovery.asciinema ']'
++ ASCIINEMA=false
+++ lscpu
+++ grep GenuineIntel
++ '[' -n '' ']'
+++ grep AuthenticAMD
+++ lscpu
++ '[' -n 'Vendor ID:                       AuthenticAMD' ']'
++ CPU_VENDOR=amd
+++ lspci -nn
+++ grep '\[03'
+++ grep -i intel
++ '[' -n '' ']'
+++ lspci -nn
+++ grep -i amd
+++ grep '\[03'
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i nvidia
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i vmware
++ '[' -n '00:02.0 VGA compatible controller [0300]: VMware SVGA II Adapter [15ad:0405]' ']'
++ GPU_VENDOR=vmware
+++ systemd-detect-virt
+++ grep -i oracle
++ '[' -n oracle ']'
++ VIRTUALBOX=true
+++ systemd-detect-virt
+++ grep -i vmware
++ '[' -n '' ']'
+++ whoami
++ USER_NAME_INSTALL=root
++ '[' root == root ']'
++ SYSTEM_INSTALLATION=true
+++ echo /dev/sda
+++ grep '^/dev/[a-z]d[a-z]'
++ '[' -n /dev/sda ']'

[0;96m# checks() step[0m

++ DEVICE_SATA=true
++ '[' auto == auto ']'
++ case "$GPU_VENDOR" in
++ case "$AUR_PACKAGE" in
++ AUR_COMMAND=paru
++ '[' auto == auto ']'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ BOOTLOADER=grub
+ execute_step checks
+ local STEP=checks
+ eval checks
++ checks
++ print_step 'checks()'
++ STEP='checks()'
++ echo ''
++ echo -e '\033[0;96m# checks() step\033[0m'
++ echo ''
++ check_facts
++ '[' bios == bios ']'
++ check_variables_list BOOTLOADER grub grub true true
++ local NAME=BOOTLOADER
++ local VALUE=grub
++ local VALUES=grub
++ local REQUIRED=true
++ local SINGLE=true
++ '[' true == '' -o true == true ']'
++ check_variables_value BOOTLOADER grub
++ local NAME=BOOTLOADER
++ local VALUE=grub
++ '[' -z grub ']'

[0;96m# prepare() step[0m

++ [[ true == '' ]]
++ [[ true == \t\r\u\e ]]
++ [[ grub != '' ]]
++ [[ grub =~   ]]
+++ echo grub
+++ grep -F -w grub
++ '[' grub '!=' '' -a -z grub ']'
+ execute_step prepare
+ local STEP=prepare
+ eval prepare
++ prepare
++ print_step 'prepare()'
++ STEP='prepare()'
++ echo ''
++ echo -e '\033[0;96m# prepare() step\033[0m'
++ echo ''
++ configure_reflector
++ '[' false == false ']'
++ systemctl stop reflector.service
++ configure_time
++ timedatectl set-ntp true
++ prepare_partition
++ set +e
++ mountpoint -q /mnt/boot
++ '[' 1 == 0 ']'
++ mountpoint -q /mnt
++ '[' 32 == 0 ']'
++ lvs vg-root
  Volume group "vg-root" not found
  Cannot process volume group vg-root
++ '[' 5 == 0 ']'
++ vgs vg
  Volume group "vg" not found
  Cannot process volume group vg
++ '[' 5 == 0 ']'
++ '[' -e /dev/mapper/cryptroot ']'
++ set -e
++ ask_passwords
++ '[' '' == ask ']'
++ '[' -n '' -a ask == ask ']'
++ '[' changeme == ask ']'
++ '[' changeme == ask ']'
++ configure_network
++ '[' -n '' ']'
++ ping -c 1 -i 2 -W 5 -w 30 mirrors.kernel.org
PING mirrors.pdx.kernel.org (198.145.21.9) 56(84) bytes of data.
64 bytes from mirrors.pdx.kernel.org (198.145.21.9): icmp_seq=1 ttl=63 time=174 ms

--- mirrors.pdx.kernel.org ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 173.523/173.523/173.523/0.000 ms
++ '[' 0 -ne 0 ']'

[0;96m# partition() step[0m

+ execute_step partition
+ local STEP=partition
+ eval partition
++ partition
++ print_step 'partition()'
++ STEP='partition()'
++ echo ''
++ echo -e '\033[0;96m# partition() step\033[0m'
++ echo ''
++ partprobe -s /dev/sda
/dev/sda: gpt partitions 1 2 3
++ partition_setup
++ '[' auto == auto ']'
++ PARTITION_PARTED_FILE_SYSTEM_TYPE=zfs
++ '[' zfs == f2fs ']'
++ '[' zfs == zfs ']'
++ PARTITION_PARTED_UEFI='#TODO'
++ PARTITION_PARTED_BIOS='mklabel gpt mkpart non-fs 0% 2 mkpart bpool 2 1000 mkpart rpool 1000 100% set 1 bios_grub on set 2 boot on'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ '[' true == true ']'
++ PARTITION_BOOT=/dev/sda1
++ PARTITION_ROOT=/dev/sda2
++ DEVICE_ROOT=/dev/sda2
++ '[' false == true ']'
++ '[' false == true ']'
++ '[' auto == custom -o auto == manual ']'
++ PARTITION_BOOT_NUMBER=/dev/sda1
++ PARTITION_ROOT_NUMBER=/dev/sda2
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ '[' zfs '!=' zfs ']'
++ '[' zfs == zfs ']'
++ load_zfs
++ curl -s https://eoli3n.github.io/archzfs/init
++ bash

[1m> Testing if archiso is running[0m

[1m> Increasing cowspace to half of RAM[0m

[1m> Adding archzfs repo[0m

[1m> Current kernel version is 5.15.12-arch1-1[0m

[1m> Searching zfs-linux on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Searching zfs-linux on http://archzfs.com/archive_archzfs/...[0m

[1m> Package "zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst" found[0m
/alis

[1m> Downloading to /tmp/zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst ...[0m

[1m> Extracting zfs-utils version from zfs-linux PKGINFO[0m

[1m> Searching zfs-utils on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Package "zfs-utils-2.1.2-1-x86_64.pkg.tar.zst" found[0m

[1m> Installing zfs-utils and zfs-linux[0m

[32mZFS is ready

+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda2
++ BOOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda3
++ ROOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ echo ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ create_zfs_datasets ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ ZFS_BOOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ ZFS_ROOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zpool create -f -o ashift=12 -d -o feature@async_destroy=enabled -o feature@bookmarks=enabled -o feature@embedded_data=enabled -o feature@empty_bpobj=enabled -o feature@enabled_txg=enabled -o feature@extensible_dataset=enabled -o feature@filesystem_limits=enabled -o feature@hole_birth=enabled -o feature@large_blocks=enabled -o feature@lz4_compress=enabled -o feature@spacemap_histogram=enabled -o feature@zpool_checkpoint=enabled -O acltype=posixacl -O canmount=off -O compression=lz4 -O devices=off -O normalization=formD -O relatime=on -O xattr=sa -O mountpoint=/boot -R /mnt bpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ echo changeme
++ zpool create -f -o ashift=12 -O acltype=posixacl -O relatime=on -O xattr=sa -O dnodesize=legacy -O normalization=formD -O mountpoint=none -O canmount=off -O devices=off -R /mnt -O compression=lz4 -O encryption=aes-256-gcm -O keyformat=passphrase -O keylocation=prompt rpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zfs create -o mountpoint=/boot bpool/boot
++ zfs create -o mountpoint=none rpool/data
++ zfs create -o mountpoint=none rpool/ROOT
++ zfs create -o mountpoint=/ -o canmount=noauto rpool/ROOT/default
++ zfs create -o mountpoint=/home rpool/data/home
++ zfs create -o mountpoint=/root rpool/data/home/root
++ zfs create -o mountpoint=/var -o canmount=off rpool/var
++ zfs create rpool/var/log
++ zfs create -o acltype=posixacl rpool/var/logjournal
++ zfs create -o mountpoint=/var/lib -o canmount=off rpool/var/lib
++ zfs create rpool/var/lib/libvirt
++ zfs create rpool/var/lib/docker
++ zpool export bpool
++ zpool export rpool
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3 -R /mnt rpool -N
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 -R /mnt bpool -N
++ echo changeme
++ zfs load-key rpool
++ zfs mount rpool/ROOT/default
++ zfs mount -a
++ zpool set bootfs=rpool/ROOT/default rpool
++ partition_options
++ PARTITION_OPTIONS_BOOT=defaults
++ PARTITION_OPTIONS=defaults
++ '[' true == true ']'
++ PARTITION_OPTIONS_BOOT=defaults,noatime
++ PARTITION_OPTIONS=defaults,noatime
++ '[' zfs == f2fs ']'
++ '[' zfs == btrfs ']'
++ partition_mount
++ '[' zfs == btrfs ']'
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ BOOT_DIRECTORY=/boot
++ ESP_DIRECTORY=/boot
+++ blkid -s UUID -o value /dev/sda1
++ UUID_BOOT=
+++ blkid -s UUID -o value /dev/sda2
++ UUID_ROOT=10106244281172033296
+++ blkid -s PARTUUID -o value /dev/sda1
++ PARTUUID_BOOT=a3caf38a-782c-43e8-9b05-e99d6a2fd018
+++ blkid -s PARTUUID -o value /dev/sda2
++ PARTUUID_ROOT=9c5498f2-e8b7-48b2-8254-bc366ab36abd

[0;96m# install() step[0m
+ execute_step install
+ local STEP=install
+ eval install
++ install
++ print_step 'install()'
++ STEP='install()'
++ echo ''
++ echo -e '\033[0;96m# install() step\033[0m'
++ echo ''
++ '[' -n 'https://mirrors.kernel.org/archlinux/$repo/os/$arch' ']'
++ echo 'Server = https://mirrors.kernel.org/archlinux/$repo/os/$arch'
++ '[' false == true ']'
++ sed -i s/#Color/Color/ /etc/pacman.conf

++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /etc/pacman.conf
++ pacstrap /mnt base base-devel linux linux-firmware
==> Creating install root at /mnt
==> Installing packages to /mnt
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: There are 24 members in group base-devel:
:: Repository core
   1) autoconf  2) automake  3) binutils  4) bison  5) fakeroot  6) file  7) findutils  8) flex  9) gawk  10) gcc  11) gettext  12) grep  13) groff  14) gzip  15) libtool  16) m4  17) make  18) pacman  19) patch  20) pkgconf  21) sed  22) sudo  23) texinfo  24) which

Enter a selection (default=all): 
resolving dependencies...
:: There are 3 providers available for initramfs:
:: Repository core
   1) mkinitcpio
:: Repository extra
   2) booster  3) dracut

Enter a number (default=1): 
looking for conflicting packages...

Packages (139) acl-2.3.1-1  archlinux-keyring-20220125-1  argon2-20190702-4  attr-2.5.1-1  audit-3.0.6-5  bash-5.1.016-1  brotli-1.0.9-7  bzip2-1.0.8-4  ca-certificates-20210603-1  ca-certificates-mozilla-3.74-1  ca-certificates-utils-20210603-1  coreutils-9.0-2  cryptsetup-2.4.3-1  curl-7.81.0-1  db-5.3.28-5  dbus-1.12.20-1  device-mapper-2.03.14-2  diffutils-3.8-1  e2fsprogs-1.46.5-1  elfutils-0.186-2  expat-2.4.3-1  filesystem-2021.12.07-1  gc-8.2.0-2  gcc-libs-11.1.0-3  gdbm-1.22-1  glib2-2.70.3-1  glibc-2.33-5  gmp-6.2.1-1  gnupg-2.2.32-2  gnutls-3.7.3-1  gpgme-1.16.0-3  guile-2.2.7-2  hwdata-0.355-1  iana-etc-20220110-1  icu-70.1-1  iproute2-5.16.0-1  iptables-1:1.8.7-1  iputils-20211215-1  json-c-0.15-2  kbd-2.4.0-2  keyutils-1.6.3-1  kmod-29-1  krb5-1.19.2-2  less-1:590-1  libarchive-3.5.2-2  libassuan-2.5.5-1  libcap-2.63-1  libcap-ng-0.8.2-6  libcroco-0.6.13-2  libelf-0.186-2  libffi-3.4.2-4  libgcrypt-1.9.4-1  libgpg-error-1.43-1  libidn2-2.3.2-1  libksba-1.6.0-1  libldap-2.6.1-1  libmnl-1.0.4-3  libmpc-1.2.1-1  libnetfilter_conntrack-1.0.8-1  libnfnetlink-1.0.1-4  libnftnl-1.2.1-1  libnghttp2-1.46.0-1  libnl-3.5.0-3  libp11-kit-0.24.1-1  libpcap-1.10.1-1  libpsl-0.21.1-1  libsasl-2.1.27-3  libseccomp-2.5.3-3  libsecret-0.20.4-1  libssh2-1.10.0-1  libsysprof-capture-3.42.1-2  libtasn1-4.18.0-1  libtirpc-1.3.2-1  libunistring-0.9.10-3  libxcrypt-4.4.27-1  libxml2-2.9.12-7  licenses-20220125-1  linux-api-headers-5.12.3-1  linux-firmware-whence-20220119.0c6a7b3-2  lz4-1:1.9.3-2  mkinitcpio-31-2  mkinitcpio-busybox-1.34.1-1  mpfr-4.1.0.p13-1  ncurses-6.3-1  nettle-3.7.3-1  npth-1.6-3  openssl-1.1.1.m-1  p11-kit-0.24.1-1  pacman-mirrorlist-20220116-1  pam-1.5.2-1  pambase-20211210-1  pciutils-3.7.0-2  pcre-8.45-1  pcre2-10.39-1  perl-5.34.0-3  pinentry-1.2.0-1  popt-1.18-2  procps-ng-3.3.17-1  psmisc-23.4-1  readline-8.1.001-1  shadow-4.8.1-4  sqlite-3.37.2-1  systemd-250.3-1  systemd-libs-250.3-1  systemd-sysvcompat-250.3-1  tar-1.34-1  tzdata-2021e-1  util-linux-2.37.3-1  util-linux-libs-2.37.3-1  xz-5.2.5-2  zlib-1:1.2.11-5  zstd-1.5.2-1  autoconf-2.71-1  automake-1.16.5-1  base-2-2  binutils-2.36.1-3  bison-3.8.2-1  fakeroot-1.27-1  file-5.41-1  findutils-4.8.0-1  flex-2.6.4-3  gawk-5.1.1-1  gcc-11.1.0-3  gettext-0.21-1  grep-3.7-1  groff-1.22.4-6  gzip-1.11-1  libtool-2.4.6+42+gb88cebd5-16  linux-5.16.2.arch1-1  linux-firmware-20220119.0c6a7b3-2  m4-1.4.19-1  make-4.3-3  pacman-6.0.1-3  patch-2.7.6-8  pkgconf-1.8.0-1  sed-4.8-1  sudo-1.9.8.p2-3  texinfo-6.8-2  which-2.21-5

Total Download Size:    477.67 MiB
Total Installed Size:  1116.91 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-5.16.2.arch1-1-x86_64 downloading...
 linux-firmware-20220119.0c6a7b3-2-any downloading...
 gcc-11.1.0-3-x86_64 downloading...
 gcc-libs-11.1.0-3-x86_64 downloading...
 perl-5.34.0-3-x86_64 downloading...
 icu-70.1-1-x86_64 downloading...
 glibc-2.33-5-x86_64 downloading...
 systemd-250.3-1-x86_64 downloading...
 guile-2.2.7-2-x86_64 downloading...
 binutils-2.36.1-3-x86_64 downloading...
 openssl-1.1.1.m-1-x86_64 downloading...
 glib2-2.70.3-1-x86_64 downloading...
 gnutls-3.7.3-1-x86_64 downloading...
 coreutils-9.0-2-x86_64 downloading...
 gnupg-2.2.32-2-x86_64 downloading...
 util-linux-2.37.3-1-x86_64 downloading...
 groff-1.22.4-6-x86_64 downloading...
 gettext-0.21-1-x86_64 downloading...
 sqlite-3.37.2-1-x86_64 downloading...
 bash-5.1.016-1-x86_64 downloading...
 sudo-1.9.8.p2-3-x86_64 downloading...
 texinfo-6.8-2-x86_64 downloading...
 libxml2-2.9.12-7-x86_64 downloading...
 krb5-1.19.2-2-x86_64 downloading...
 kbd-2.4.0-2-x86_64 downloading...
 e2fsprogs-1.46.5-1-x86_64 downloading...
 shadow-4.8.1-4-x86_64 downloading...
 gawk-5.1.1-1-x86_64 downloading...
 ncurses-6.3-1-x86_64 downloading...
 linux-api-headers-5.12.3-1-any downloading...
 curl-7.81.0-1-x86_64 downloading...
 pcre2-10.39-1-x86_64 downloading...
 db-5.3.28-5-x86_64 downloading...
 iproute2-5.16.0-1-x86_64 downloading...
 archlinux-keyring-20220125-1-any downloading...
 pcre-8.45-1-x86_64 downloading...
 pacman-6.0.1-3-x86_64 downloading...
 tar-1.34-1-x86_64 downloading...
 bison-3.8.2-1-x86_64 downloading...
 zstd-1.5.2-1-x86_64 downloading...
 autoconf-2.71-1-any downloading...
 libunistring-0.9.10-3-x86_64 downloading...
 systemd-libs-250.3-1-x86_64 downloading...
 automake-1.16.5-1-any downloading...
 cryptsetup-2.4.3-1-x86_64 downloading...
 pam-1.5.2-1-x86_64 downloading...
 elfutils-0.186-2-x86_64 downloading...
 libgcrypt-1.9.4-1-x86_64 downloading...
 libelf-0.186-2-x86_64 downloading...
 procps-ng-3.3.17-1-x86_64 downloading...
 libarchive-3.5.2-2-x86_64 downloading...
 findutils-4.8.0-1-x86_64 downloading...
 make-4.3-3-x86_64 downloading...
 hwdata-0.355-1-any downloading...
 libp11-kit-0.24.1-1-x86_64 downloading...
 gpgme-1.16.0-3-x86_64 downloading...
 gmp-6.2.1-1-x86_64 downloading...
 iptables-1:1.8.7-1-x86_64 downloading...
 nettle-3.7.3-1-x86_64 downloading...
 libtool-2.4.6+42+gb88cebd5-16-x86_64 downloading...
 mpfr-4.1.0.p13-1-x86_64 downloading...
 libnl-3.5.0-3-x86_64 downloading...
 tzdata-2021e-1-x86_64 downloading...
 iana-etc-20220110-1-any downloading...
 brotli-1.0.9-7-x86_64 downloading...
 audit-3.0.6-5-x86_64 downloading...
 diffutils-3.8-1-x86_64 downloading...
 file-5.41-1-x86_64 downloading...
 util-linux-libs-2.37.3-1-x86_64 downloading...
 ca-certificates-mozilla-3.74-1-x86_64 downloading...
 readline-8.1.001-1-x86_64 downloading...
 dbus-1.12.20-1-x86_64 downloading...
 xz-5.2.5-2-x86_64 downloading...
 flex-2.6.4-3-x86_64 downloading...
 device-mapper-2.03.14-2-x86_64 downloading...
 libldap-2.6.1-1-x86_64 downloading...
 libpcap-1.10.1-1-x86_64 downloading...
 mkinitcpio-busybox-1.34.1-1-x86_64 downloading...
 gdbm-1.22-1-x86_64 downloading...
 m4-1.4.19-1-x86_64 downloading...
 grep-3.7-1-x86_64 downloading...
 libsecret-0.20.4-1-x86_64 downloading...
 sed-4.8-1-x86_64 downloading...
 libgpg-error-1.43-1-x86_64 downloading...
 gc-8.2.0-2-x86_64 downloading...
 libssh2-1.10.0-1-x86_64 downloading...
 psmisc-23.4-1-x86_64 downloading...
 libtirpc-1.3.2-1-x86_64 downloading...
 libcroco-0.6.13-2-x86_64 downloading...
 libsasl-2.1.27-3-x86_64 downloading...
 p11-kit-0.24.1-1-x86_64 downloading...
 libidn2-2.3.2-1-x86_64 downloading...
 libksba-1.6.0-1-x86_64 downloading...
 acl-2.3.1-1-x86_64 downloading...
 iputils-20211215-1-x86_64 downloading...
 libtasn1-4.18.0-1-x86_64 downloading...
 pinentry-1.2.0-1-x86_64 downloading...
 lz4-1:1.9.3-2-x86_64 downloading...
 expat-2.4.3-1-x86_64 downloading...
 less-1:590-1-x86_64 downloading...
 libassuan-2.5.5-1-x86_64 downloading...
 kmod-29-1-x86_64 downloading...
 keyutils-1.6.3-1-x86_64 downloading...
 pciutils-3.7.0-2-x86_64 downloading...
 libnghttp2-1.46.0-1-x86_64 downloading...
 patch-2.7.6-8-x86_64 downloading...
 zlib-1:1.2.11-5-x86_64 downloading...
 libxcrypt-4.4.27-1-x86_64 downloading...
 libseccomp-2.5.3-3-x86_64 downloading...
 libcap-2.63-1-x86_64 downloading...
 gzip-1.11-1-x86_64 downloading...
 libpsl-0.21.1-1-x86_64 downloading...
 popt-1.18-2-x86_64 downloading...
 libmpc-1.2.1-1-x86_64 downloading...
 fakeroot-1.27-1-x86_64 downloading...
 libnftnl-1.2.1-1-x86_64 downloading...
 licenses-20220125-1-any downloading...
 attr-2.5.1-1-x86_64 downloading...
 pkgconf-1.8.0-1-x86_64 downloading...
 bzip2-1.0.8-4-x86_64 downloading...
 json-c-0.15-2-x86_64 downloading...
 libnetfilter_conntrack-1.0.8-1-x86_64 downloading...
 libsysprof-capture-3.42.1-2-x86_64 downloading...
 libffi-3.4.2-4-x86_64 downloading...
 mkinitcpio-31-2-any downloading...
 libcap-ng-0.8.2-6-x86_64 downloading...
 argon2-20190702-4-x86_64 downloading...
 linux-firmware-whence-20220119.0c6a7b3-2-any downloading...
 npth-1.6-3-x86_64 downloading...
 libnfnetlink-1.0.1-4-x86_64 downloading...
 which-2.21-5-x86_64 downloading...
 filesystem-2021.12.07-1-x86_64 downloading...
 libmnl-1.0.4-3-x86_64 downloading...
 ca-certificates-utils-20210603-1-any downloading...
 pacman-mirrorlist-20220116-1-any downloading...
 systemd-sysvcompat-250.3-1-x86_64 downloading...
 pambase-20211210-1-any downloading...
 base-2-2-any downloading...
 ca-certificates-20210603-1-any downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing iana-etc...
installing filesystem...
warning: directory permissions differ on /mnt/root/
filesystem: 755  package: 750
installing linux-api-headers...
installing tzdata...
installing glibc...
Optional dependencies for glibc
    gd: for memusagestat
installing gcc-libs...
installing ncurses...
Optional dependencies for ncurses
    bash: for ncursesw6-config [pending]
installing readline...
installing bash...
Optional dependencies for bash
    bash-completion: for tab completion
installing attr...
installing acl...
installing gmp...
installing util-linux-libs...
installing e2fsprogs...
installing openssl...
Optional dependencies for openssl
    ca-certificates [pending]
    perl [pending]
installing libsasl...
installing libldap...
installing keyutils...
installing krb5...
installing libtirpc...
installing pambase...
installing libcap-ng...
installing audit...
installing libxcrypt...
installing pam...
installing libcap...
installing coreutils...
installing zlib...
installing xz...
installing bzip2...
installing libseccomp...
installing file...
installing findutils...
installing mpfr...
installing gawk...
installing pcre...
installing grep...
installing libgpg-error...
installing libgcrypt...
installing libtasn1...
installing libffi...
installing libp11-kit...
installing lz4...
installing zstd...
installing systemd-libs...
installing procps-ng...
installing sed...
installing tar...
installing libsysprof-capture...
installing glib2...
Optional dependencies for glib2
    python: gdbus-codegen, glib-genmarshal, glib-mkenums, gtester-report
    libelf: gresource inspection tool [pending]
installing libunistring...
installing icu...
installing libxml2...
installing libcroco...
installing gettext...
Optional dependencies for gettext
    git: for autopoint infrastructure updates
installing hwdata...
installing kmod...
installing pciutils...
installing psmisc...
installing shadow...
installing util-linux...
Optional dependencies for util-linux
    python: python bindings to libmount
    words: default dictionary for look
installing pcre2...
installing less...
installing gzip...
installing licenses...
installing expat...
installing libarchive...
installing p11-kit...
installing ca-certificates-utils...
installing ca-certificates-mozilla...
installing ca-certificates...
installing brotli...
installing libidn2...
installing libnghttp2...
installing libpsl...
installing libssh2...
installing curl...
installing npth...
installing libksba...
installing libassuan...
installing libsecret...
Optional dependencies for libsecret
    org.freedesktop.secrets: secret storage backend
installing pinentry...
Optional dependencies for pinentry
    gtk2: gtk2 backend
    qt5-base: qt backend
    gcr: gnome3 backend
installing nettle...
installing gnutls...
Optional dependencies for gnutls
    guile: for use with Guile bindings [pending]
installing sqlite...
installing gnupg...
Optional dependencies for gnupg
    libldap: gpg2keys_ldap [installed]
    libusb-compat: scdaemon
    pcsclite: scdaemon
installing gpgme...
installing pacman-mirrorlist...
installing archlinux-keyring...
installing pacman...
Optional dependencies for pacman
    perl-locale-gettext: translation support in makepkg-template
installing device-mapper...
installing popt...
installing json-c...
installing argon2...
installing cryptsetup...
installing dbus...
installing libmnl...
installing libnftnl...
installing libnl...
installing libpcap...
installing libnfnetlink...
installing libnetfilter_conntrack...
installing iptables...
installing kbd...
installing libelf...
installing systemd...
Initializing machine ID from random generator.
Creating group 'sys' with GID 3.
Creating group 'mem' with GID 8.
Creating group 'ftp' with GID 11.
Creating group 'mail' with GID 12.
Creating group 'log' with GID 19.
Creating group 'smmsp' with GID 25.
Creating group 'proc' with GID 26.
Creating group 'games' with GID 50.
Creating group 'lock' with GID 54.
Creating group 'network' with GID 90.
Creating group 'floppy' with GID 94.
Creating group 'scanner' with GID 96.
Creating group 'power' with GID 98.
Creating group 'nobody' with GID 65534.
Creating group 'adm' with GID 999.
Creating group 'wheel' with GID 998.
Creating group 'utmp' with GID 997.
Creating group 'audio' with GID 996.
Creating group 'disk' with GID 995.
Creating group 'input' with GID 994.
Creating group 'kmem' with GID 993.
Creating group 'kvm' with GID 992.
Creating group 'lp' with GID 991.
Creating group 'optical' with GID 990.
Creating group 'render' with GID 989.
Creating group 'sgx' with GID 988.
Creating group 'storage' with GID 987.
Creating group 'tty' with GID 5.
Creating group 'uucp' with GID 986.
Creating group 'video' with GID 985.
Creating group 'users' with GID 984.
Creating group 'systemd-journal' with GID 983.
Creating group 'rfkill' with GID 982.
Creating group 'bin' with GID 1.
Creating user 'bin' (n/a) with UID 1 and GID 1.
Creating group 'daemon' with GID 2.
Creating user 'daemon' (n/a) with UID 2 and GID 2.
Creating user 'mail' (n/a) with UID 8 and GID 12.
Creating user 'ftp' (n/a) with UID 14 and GID 11.
Creating group 'http' with GID 33.
Creating user 'http' (n/a) with UID 33 and GID 33.
Creating user 'nobody' (Nobody) with UID 65534 and GID 65534.
Creating group 'dbus' with GID 81.
Creating user 'dbus' (System Message Bus) with UID 81 and GID 81.
Creating group 'systemd-coredump' with GID 981.
Creating user 'systemd-coredump' (systemd Core Dumper) with UID 981 and GID 981.
Creating group 'systemd-network' with GID 980.
Creating user 'systemd-network' (systemd Network Management) with UID 980 and GID 980.
Creating group 'systemd-oom' with GID 979.
Creating user 'systemd-oom' (systemd Userspace OOM Killer) with UID 979 and GID 979.
Creating group 'systemd-journal-remote' with GID 978.
Creating user 'systemd-journal-remote' (systemd Journal Remote) with UID 978 and GID 978.
Creating group 'systemd-resolve' with GID 977.
Creating user 'systemd-resolve' (systemd Resolver) with UID 977 and GID 977.
Creating group 'systemd-timesync' with GID 976.
Creating user 'systemd-timesync' (systemd Time Synchronization) with UID 976 and GID 976.
Creating group 'uuidd' with GID 68.
Creating user 'uuidd' (n/a) with UID 68 and GID 68.
Created symlink /etc/systemd/system/getty.target.wants/getty@tty1.service → /usr/lib/systemd/system/getty@.service.
Created symlink /etc/systemd/system/multi-user.target.wants/remote-fs.target → /usr/lib/systemd/system/remote-fs.target.
:: Append 'init=/usr/lib/systemd/systemd' to your kernel command line in your
   bootloader to replace sysvinit with systemd, or install systemd-sysvcompat
Optional dependencies for systemd
    libmicrohttpd: remote journald capabilities
    quota-tools: kernel-level quota management
    systemd-sysvcompat: symlink package to provide sysvinit binaries [pending]
    polkit: allow administration as unprivileged user
    curl: machinectl pull-tar and pull-raw [installed]
    libfido2: unlocking LUKS2 volumes with FIDO2 token
    tpm2-tss: unlocking LUKS2 volumes with TPM2
installing systemd-sysvcompat...
installing iputils...
installing iproute2...
Optional dependencies for iproute2
    db: userspace arp daemon [pending]
    libcap: tipc [installed]
    linux-atm: ATM support
installing base...
Optional dependencies for base
    linux: bare metal support [pending]
installing m4...
installing diffutils...
installing gdbm...
installing db...
installing perl...
installing autoconf...
installing automake...
installing elfutils...
installing binutils...
installing bison...
installing fakeroot...
installing flex...
installing libmpc...
installing gcc...
Optional dependencies for gcc
    lib32-gcc-libs: for generating code for 32-bit ABI
installing groff...
Optional dependencies for groff
    netpbm: for use together with man -H command interaction in browsers
    psutils: for use together with man -H command interaction in browsers
    libxaw: for gxditview
    perl-file-homedir: for use with glilypond
installing libtool...
installing texinfo...
installing gc...
installing guile...
installing make...
installing patch...
Optional dependencies for patch
    ed: for patch -e functionality
installing pkgconf...
installing sudo...
installing which...
installing mkinitcpio-busybox...
installing mkinitcpio...
Optional dependencies for mkinitcpio
    gzip: Use gzip compression for the initramfs image [installed]
    xz: Use lzma or xz compression for the initramfs image [installed]
    bzip2: Use bzip2 compression for the initramfs image [installed]
    lzop: Use lzo compression for the initramfs image
    lz4: Use lz4 compression for the initramfs image [installed]
    mkinitcpio-nfs-utils: Support for root filesystem on NFS
installing linux...
Optional dependencies for linux
    crda: to set the correct wireless channels of your country
    linux-firmware: firmware images needed for some devices [pending]
installing linux-firmware-whence...
installing linux-firmware...
:: Running post-transaction hooks...
( 1/14) Creating system user accounts...
( 2/14) Updating journal message catalog...
( 3/14) Reloading system manager configuration...
  Skipped: Running in chroot.
( 4/14) Updating udev hardware database...
( 5/14) Applying kernel sysctl settings...
  Skipped: Running in chroot.
( 6/14) Creating temporary files...
( 7/14) Reloading device manager configuration...
  Skipped: Running in chroot.
( 8/14) Arming ConditionNeedsUpdate...
( 9/14) Rebuilding certificate stores...
(10/14) Updating module dependencies...
(11/14) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> ERROR: file not found: `fsck.zfs'
==> WARNING: No fsck helpers found. fsck will not be run on boot.
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> WARNING: errors were encountered during the build. The image may not be complete.
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
error: command failed to execute correctly
(12/14) Reloading system bus configuration...
  Skipped: Running in chroot.
(13/14) Warn about old perl modules
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_MESSAGES = "",
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
(14/14) Updating the info directory file...
++ '[' zfs == zfs ']'
++ cat
++ sed -i s/#Color/Color/ /mnt/etc/pacman.conf
++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /mnt/etc/pacman.conf
++ '[' false == true ']'
+ execute_step configure_zfs
+ local STEP=configure_zfs
+ eval configure_zfs
++ configure_zfs
++ pacman_install zfs-linux
++ local ERROR=true
++ set +e
++ PACKAGES=('zfs-linux')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ execute_sudo 'pacman -Syu --noconfirm --needed zfs-linux'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zfs-linux'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) zfs-utils-2.1.2-1  zfs-linux-2.1.2_5.16.2.arch1.1-1

Total Download Size:   48.77 MiB
Total Installed Size:  60.28 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 zfs-utils-2.1.2-1-x86_64 downloading...
 zfs-linux-2.1.2_5.16.2.arch1.1-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing zfs-utils...
Optional dependencies for zfs-utils
    python: pyzfs and extra utilities,
    python-cffi: pyzfs
installing zfs-linux...
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Updating module dependencies...
(5/5) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache rpool
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache bpool
++ arch-chroot /mnt systemctl enable zfs-import-cache zfs-import.target zfs-mount zfs-zed zfs.target
Created symlink /etc/systemd/system/zfs-import.target.wants/zfs-import-cache.service → /usr/lib/systemd/system/zfs-import-cache.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-import.target → /usr/lib/systemd/system/zfs-import.target.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-mount.service → /usr/lib/systemd/system/zfs-mount.service.
Created symlink /etc/systemd/system/zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/multi-user.target.wants/zfs.target → /usr/lib/systemd/system/zfs.target.

+ execute_step configuration
+ local STEP=configuration
+ eval configuration
++ configuration
++ print_step 'configuration()'
++ STEP='configuration()'
++ echo ''
++ echo -e '\033[0;96m# configuration() step\033[0m'
++ echo ''
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ '[' true == true ']'
++ '[' zfs == f2fs ']'
++ sed -i s/relatime/noatime/ /mnt/etc/fstab
++ arch-chroot /mnt systemctl enable fstrim.timer
[0;96m# configuration() step[0m

Created symlink /etc/systemd/system/timers.target.wants/fstrim.timer → /usr/lib/systemd/system/fstrim.timer.
++ arch-chroot /mnt ln -s -f /usr/share/zoneinfo/Europe/Berlin /etc/localtime
++ arch-chroot /mnt hwclock --systohc
++ for LOCALE in "${LOCALES[@]}"
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /mnt/etc/locale.gen
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANG=en_US.UTF-8
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANGUAGE=en_US:en
++ locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ arch-chroot /mnt locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ echo -e 'KEYMAP=en\n\n'
++ echo archlinux
++ local OPTIONS=
++ '[' -n en ']'
++ local 'OPTIONS=
    Option "XkbLayout" "en"'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ arch-chroot /mnt mkdir -p /etc/X11/xorg.conf.d/
++ cat
++ '[' -n '' ']'
++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd
New password: Retype new password: passwd: password updated successfully
+ execute_step mkinitcpio_configuration
+ local STEP=mkinitcpio_configuration
+ eval mkinitcpio_configuration

++ mkinitcpio_configuration
++ print_step 'mkinitcpio_configuration()'
++ STEP='mkinitcpio_configuration()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio_configuration() step\033[0m'
++ echo ''
++ '[' true == true ']'
++ local MKINITCPIO_KMS_MODULES=
++ case "$DISPLAY_DRIVER" in
++ local 'MODULES=!vmd '
++ '[' auto == intel ']'
++ '[' false == true ']'
++ '[' zfs == btrfs ']'
++ '[' zfs == xfs ']'
++ '[' zfs == f2fs ']'
++ '[' zfs == reiserfs ']'
++ '[' false == true ']'
++ '[' grub == systemd ']'
+++ echo 'base !udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!udev/udev/'
[0;96m# mkinitcpio_configuration() step[0m

++ HOOKS='base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!usr/usr/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!keymap/keymap/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!consolefont/consolefont/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++ '[' -n '' ']'
+++ sanitize_variable 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ local 'VARIABLE=base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++++ sed 's/![^ ]*//g'
+++ local 'VARIABLE=base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ echo 'base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/^[[:space:]]*//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/[[:space:]]*$//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++ HOOKS='base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ sanitize_variable '!vmd '
+++ local 'VARIABLE=!vmd '
++++ echo '!vmd '
++++ sed 's/![^ ]*//g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed 's/^[[:space:]]*//'
+++ local VARIABLE=
++++ echo ''
++++ sed 's/[[:space:]]*$//'
+++ local VARIABLE=
+++ echo ''
++ MODULES=
++ arch-chroot /mnt sed -i 's/^HOOKS=(.*)$/HOOKS=(base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems)/' /etc/mkinitcpio.conf
++ arch-chroot /mnt sed -i 's/^MODULES=(.*)/MODULES=()/' /etc/mkinitcpio.conf
++ '[' zstd '!=' '' ']'
++ arch-chroot /mnt sed -i 's/^#COMPRESSION="zstd"/COMPRESSION="zstd"/' /etc/mkinitcpio.conf
++ '[' zstd == bzip2 ']'
++ '[' zstd == lzma -o zstd == xz ']'
++ '[' zstd == lzop ']'
++ '[' zstd == lz4 ']'
++ '[' zstd == zstd ']'
++ pacman_install zstd
++ local ERROR=true
++ set +e
++ PACKAGES=('zstd')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ execute_sudo 'pacman -Syu --noconfirm --needed zstd'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zstd'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
warning: zstd-1.5.2-1 is up to date -- skipping
:: Starting full system upgrade...
 there is nothing to do
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e

[0;96m# users() step[0m

++ '[' false == true ']'
+ execute_step users
+ local STEP=users
+ eval users
++ users
++ print_step 'users()'
++ STEP='users()'
++ echo ''
++ echo -e '\033[0;96m# users() step\033[0m'
++ echo ''
++ local USERS_GROUPS=wheel,storage,optical
++ create_user pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USERS_GROUPS=wheel,storage,optical
++ '[' false == true ']'
++ create_user_useradd pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USER_GROUPS=wheel,storage,optical
++ arch-chroot /mnt useradd -m -G wheel,storage,optical -s /bin/bash pai
++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd pai
New password: Retype new password: passwd: password updated successfully
++ arch-chroot /mnt sed -i 's/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/' /etc/sudoers
++ pacman_install xdg-user-dirs
++ local ERROR=true
++ set +e
++ PACKAGES=('xdg-user-dirs')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ execute_sudo 'pacman -Syu --noconfirm --needed xdg-user-dirs'
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed xdg-user-dirs'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (1) xdg-user-dirs-0.17-3

Total Download Size:   0.04 MiB
Total Installed Size:  0.15 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 xdg-user-dirs-0.17-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing xdg-user-dirs...
Created symlink /etc/systemd/user/default.target.wants/xdg-user-dirs-update.service → /usr/lib/systemd/user/xdg-user-dirs-update.service.
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ '[' false == true ']'
+ '[' -n auto ']'
+ execute_step display_driver
+ local STEP=display_driver
+ eval display_driver
++ display_driver
++ print_step 'display_driver()'
++ STEP='display_driver()'
++ echo ''
++ echo -e '\033[0;96m# display_driver() step\033[0m'
++ echo ''
++ local PACKAGES_DRIVER_PACMAN=true
++ local PACKAGES_DRIVER=
++ local PACKAGES_DRIVER_MULTILIB=
++ local PACKAGES_DDX=
++ local PACKAGES_VULKAN=
++ local PACKAGES_VULKAN_MULTILIB=
++ local PACKAGES_HARDWARE_ACCELERATION=
++ local PACKAGES_HARDWARE_ACCELERATION_MULTILIB=
++ case "$DISPLAY_DRIVER" in
++ '[' false == true ']'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ pacman_install 'mesa    '
++ local ERROR=true
++ set +e
++ PACKAGES=('mesa    ')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ execute_sudo 'pacman -Syu --noconfirm --needed mesa    '
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed mesa    '

[0;96m# display_driver() step[0m

:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...
warning: dependency cycle detected:
warning: libglvnd will be installed before its mesa dependency

Packages (22) libdrm-2.4.109-1  libedit-20210910_3.1-1  libglvnd-1.4.0-1  libomxil-bellagio-0.9.3-3  libpciaccess-0.16-2  libunwind-1.6.2-1  libx11-1.7.3.1-1  libxau-1.0.9-3  libxcb-1.14-1  libxdamage-1.1.5-3  libxdmcp-1.1.3-3  libxext-1.3.4-3  libxfixes-6.0.0-1  libxshmfence-1.3-2  libxxf86vm-1.1.4-4  llvm-libs-13.0.0-6  lm_sensors-1:3.6.0.r41.g31d1f125-1  vulkan-icd-loader-1.2.203-1  wayland-1.20.0-1  xcb-proto-1.14.1-5  xorgproto-2021.5-1  mesa-21.3.5-1

Total Download Size:    47.23 MiB
Total Installed Size:  225.80 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 llvm-libs-13.0.0-6-x86_64 downloading...
 mesa-21.3.5-1-x86_64 downloading...
 libx11-1.7.3.1-1-x86_64 downloading...
 libxcb-1.14-1-x86_64 downloading...
 libglvnd-1.4.0-1-x86_64 downloading...
 libdrm-2.4.109-1-x86_64 downloading...
 xorgproto-2021.5-1-any downloading...
 lm_sensors-1:3.6.0.r41.g31d1f125-1-x86_64 downloading...
 wayland-1.20.0-1-x86_64 downloading...
 libomxil-bellagio-0.9.3-3-x86_64 downloading...
 vulkan-icd-loader-1.2.203-1-x86_64 downloading...
 libunwind-1.6.2-1-x86_64 downloading...
 libedit-20210910_3.1-1-x86_64 downloading...
 xcb-proto-1.14.1-5-any downloading...
 libxext-1.3.4-3-x86_64 downloading...
 libxdmcp-1.1.3-3-x86_64 downloading...
 libpciaccess-0.16-2-x86_64 downloading...
 libxxf86vm-1.1.4-4-x86_64 downloading...
 libxfixes-6.0.0-1-x86_64 downloading...
 libxau-1.0.9-3-x86_64 downloading...
 libxdamage-1.1.5-3-x86_64 downloading...
 libxshmfence-1.3-2-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libpciaccess...
installing libdrm...
installing wayland...
installing xcb-proto...
installing libxdmcp...
installing libxau...
installing libxcb...
installing xorgproto...
installing libx11...
installing libxext...
installing libxxf86vm...
installing libxfixes...
installing libxdamage...
installing libxshmfence...
installing libomxil-bellagio...
installing libunwind...
installing libedit...
installing llvm-libs...
installing lm_sensors...
Optional dependencies for lm_sensors
    rrdtool: for logging with sensord
    perl: for sensor detection and configuration convert [installed]
installing libglvnd...
installing vulkan-icd-loader...
Optional dependencies for vulkan-icd-loader
    vulkan-driver: packaged vulkan driver
installing mesa...
Optional dependencies for mesa
    opengl-man-pages: for the OpenGL API man pages
    mesa-vdpau: for accelerated video playback
    libva-mesa-driver: for accelerated video playback
:: Running post-transaction hooks...
(1/2) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/2) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false

[0;96m# kernels() step[0m

++ break
++ set -e
++ '[' false == true ']'
++ '[' false == true ']'
+ execute_step kernels
+ local STEP=kernels
+ eval kernels
++ kernels
++ print_step 'kernels()'
++ STEP='kernels()'
++ echo ''
++ echo -e '\033[0;96m# kernels() step\033[0m'
++ echo ''
++ pacman_install linux-headers
++ local ERROR=true
++ set +e
++ PACKAGES=('linux-headers')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ execute_sudo 'pacman -Syu --noconfirm --needed linux-headers'
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed linux-headers'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (4) libnsl-2.0.0-1  pahole-1.23-1  python-3.10.2-1  linux-headers-5.16.2.arch1-1

Total Download Size:    37.43 MiB
Total Installed Size:  194.23 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-headers-5.16.2.arch1-1-x86_64 downloading...
 python-3.10.2-1-x86_64 downloading...
 pahole-1.23-1-x86_64 downloading...
 libnsl-2.0.0-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libnsl...
installing python...
Optional dependencies for python
    python-setuptools
    python-pip
    sqlite [installed]
    mpdecimal: for decimal
    xz: for lzma [installed]
    tk: for tkinter
installing pahole...
installing linux-headers...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating module dependencies...
++ '[' 0 == 0 ']'

[0;96m# mkinitcpio() step[0m

++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ '[' -n '' ']'
+ execute_step mkinitcpio
+ local STEP=mkinitcpio
+ eval mkinitcpio
++ mkinitcpio
++ print_step 'mkinitcpio()'
++ STEP='mkinitcpio()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio() step\033[0m'
++ echo ''
++ arch-chroot /mnt mkinitcpio -P
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [autodetect]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: aic94xx
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
+ execute_step network
+ local STEP=network
+ eval network

[0;96m# network() step[0m

++ network
++ print_step 'network()'
++ STEP='network()'
++ echo ''
++ echo -e '\033[0;96m# network() step\033[0m'
++ echo ''
++ pacman_install networkmanager
++ local ERROR=true
++ set +e
++ PACKAGES=('networkmanager')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'
++ execute_sudo 'pacman -Syu --noconfirm --needed networkmanager'
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed networkmanager'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (18) bluez-libs-5.63-1  gpm-1.20.7.r38.ge82d1a6-4  jansson-2.14-1  libdaemon-0.14-5  libmm-glib-1.18.4-1  libndp-1.8-1  libnewt-0.52.21-8  libnm-1.34.0-1  libpgm-5.3.128-1  libsodium-1.0.18-2  libteam-1.31-5  mobile-broadband-provider-info-20210805-1  nspr-4.33-1  nss-3.74-1  slang-2.3.2-2  wpa_supplicant-2:2.10-1  zeromq-4.3.4-2  networkmanager-1.34.0-1

Total Download Size:   10.98 MiB
Total Installed Size:  60.62 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 networkmanager-1.34.0-1-x86_64 downloading...
 nss-3.74-1-x86_64 downloading...
 wpa_supplicant-2:2.10-1-x86_64 downloading...
 libnm-1.34.0-1-x86_64 downloading...
 slang-2.3.2-2-x86_64 downloading...
 libmm-glib-1.18.4-1-x86_64 downloading...
 zeromq-4.3.4-2-x86_64 downloading...
 libteam-1.31-5-x86_64 downloading...
 nspr-4.33-1-x86_64 downloading...
 libpgm-5.3.128-1-x86_64 downloading...
 libsodium-1.0.18-2-x86_64 downloading...
 gpm-1.20.7.r38.ge82d1a6-4-x86_64 downloading...
 libnewt-0.52.21-8-x86_64 downloading...
 bluez-libs-5.63-1-x86_64 downloading...
 mobile-broadband-provider-info-20210805-1-any downloading...
 jansson-2.14-1-x86_64 downloading...
 libndp-1.8-1-x86_64 downloading...
 libdaemon-0.14-5-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing nspr...
installing nss...
installing jansson...
installing libnm...
installing wpa_supplicant...
installing libmm-glib...
installing gpm...
installing slang...
installing libnewt...
Optional dependencies for libnewt
    python: libnewt support with the _snack module [installed]
    tcl: whiptcl support
installing libndp...
installing libdaemon...
installing libsodium...
installing libpgm...
installing zeromq...
installing libteam...
installing bluez-libs...
installing mobile-broadband-provider-info...
installing networkmanager...
Optional dependencies for networkmanager
    polkit: let non-root users control networking
    dnsmasq: connection sharing
    nftables: connection sharing
    iptables: connection sharing [installed]
    bluez: Bluetooth support
    ppp: dialup connection support
    modemmanager: cellular network support
    iwd: wpa_supplicant alternative
    dhclient: alternative DHCP client
    dhcpcd: alternative DHCP client
    openresolv: alternative resolv.conf manager
    firewalld: firewall support
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Reloading system bus configuration...
  Skipped: Running in chroot.
(5/5) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable NetworkManager.service
Created symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service → /usr/lib/systemd/system/NetworkManager.service.
Created symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service → /usr/lib/systemd/system/NetworkManager-dispatcher.service.
Created symlink /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service → /usr/lib/systemd/system/NetworkManager-wait-online.service.
+ '[' true == true ']'
+ execute_step virtualbox
+ local STEP=virtualbox
+ eval virtualbox
++ virtualbox
++ print_step 'virtualbox()'
++ STEP='virtualbox()'
++ echo ''

[0;96m# virtualbox() step[0m

++ echo -e '\033[0;96m# virtualbox() step\033[0m'
++ echo ''
++ pacman_install virtualbox-guest-utils
++ local ERROR=true
++ set +e
++ PACKAGES=('virtualbox-guest-utils')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ execute_sudo 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (10) libice-1.0.10-3  libsm-1.2.3-2  libxcomposite-0.4.5-3  libxmu-1.1.3-2  libxrandr-1.5.2-3  libxrender-0.9.10-4  libxt-1.2.1-1  xf86-video-vmware-13.3.0-3  xorg-xrandr-1.5.1-2  virtualbox-guest-utils-6.1.32-1

Total Download Size:    2.13 MiB
Total Installed Size:  12.55 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 virtualbox-guest-utils-6.1.32-1-x86_64 downloading...
 libxt-1.2.1-1-x86_64 downloading...
 libice-1.0.10-3-x86_64 downloading...
 xf86-video-vmware-13.3.0-3-x86_64 downloading...
 libxmu-1.1.3-2-x86_64 downloading...
 libsm-1.2.3-2-x86_64 downloading...
 xorg-xrandr-1.5.1-2-x86_64 downloading...
 libxrandr-1.5.2-3-x86_64 downloading...
 libxrender-0.9.10-4-x86_64 downloading...
 libxcomposite-0.4.5-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libxcomposite...
installing libice...
installing libsm...
installing libxt...
installing libxmu...
installing libxrender...
installing libxrandr...
installing xorg-xrandr...
installing xf86-video-vmware...
installing virtualbox-guest-utils...
:: Running post-transaction hooks...
(1/4) Creating system user accounts...
Creating group 'vboxsf' with GID 109.
(2/4) Reloading system manager configuration...
  Skipped: Running in chroot.
(3/4) Reloading device manager configuration...
  Skipped: Running in chroot.
(4/4) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable vboxservice.service
Created symlink /etc/systemd/system/multi-user.target.wants/vboxservice.service → /usr/lib/systemd/system/vboxservice.service.
++ local USER_GROUPS=vboxsf
++ user_add_groups pai vboxsf
++ local USER=pai
++ local USER_GROUPS=vboxsf
++ '[' false == true ']'
++ arch-chroot /mnt usermod -a -G vboxsf pai
+ '[' '' == true ']'

[0;96m# bootloader() step[0m

+ execute_step bootloader
+ local STEP=bootloader
+ eval bootloader
++ bootloader
++ print_step 'bootloader()'
++ STEP='bootloader()'
++ echo ''
++ echo -e '\033[0;96m# bootloader() step\033[0m'
++ echo ''
++ BOOTLOADER_ALLOW_DISCARDS=
++ '[' true '!=' true -a '' '!=' true ']'
++ '[' false == true -o -n '' ']'
++ CMDLINE_LINUX_ROOT=root=UUID=10106244281172033296
++ '[' -n '' ']'
++ '[' zfs == btrfs ']'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' -n '' ']'
+++ trim_variable ''
+++ local VARIABLE=
++++ echo ''
++++ sed 's/^[[:space:]]*//'
+++ local VARIABLE=
++++ echo ''
++++ sed 's/[[:space:]]*$//'
+++ local VARIABLE=
+++ echo ''
++ CMDLINE_LINUX=
++ case "$BOOTLOADER" in
++ bootloader_grub
++ '[' zfs == zfs ']'
++ ZPOOL_VDEV_NAME_PATH=1
++ export ZPOOL_VDEV_NAME_PATH
++ pacman_install 'grub dosfstools'
++ local ERROR=true
++ set +e
++ PACKAGES=('grub dosfstools')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ execute_sudo 'pacman -Syu --noconfirm --needed grub dosfstools'
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed grub dosfstools'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) dosfstools-4.2-1  grub-2:2.06-4

Total Download Size:    6.87 MiB
Total Installed Size:  34.53 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 grub-2:2.06-4-x86_64 downloading...
 dosfstools-4.2-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing grub...
:: Generate your bootloader configuration with:
     grub-mkconfig -o /boot/grub/grub.cfg
Optional dependencies for grub
    freetype2: For grub-mkfont usage
    fuse2: For grub-mount usage
    dosfstools: For grub-mkrescue FAT FS and EFI support [pending]
    lzop: For grub-mkrescue LZO support
    efibootmgr: For grub-install EFI support
    libisoburn: Provides xorriso for generating grub rescue iso using grub-mkrescue
    os-prober: To detect other OSes when generating grub.cfg in BIOS systems
    mtools: For grub-mkrescue FAT FS support
installing dosfstools...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt sed -i s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/ /etc/default/grub
++ arch-chroot /mnt sed -i 's/#GRUB_SAVEDEFAULT="true"/GRUB_SAVEDEFAULT="true"/' /etc/default/grub
++ arch-chroot /mnt sed -i -E 's/GRUB_CMDLINE_LINUX_DEFAULT="(.*) quiet"/GRUB_CMDLINE_LINUX_DEFAULT="\1"/' /etc/default/grub
++ arch-chroot /mnt sed -i 's/GRUB_CMDLINE_LINUX=""/GRUB_CMDLINE_LINUX=""/' /etc/default/grub
++ echo ''
++ echo '# alis'
++ echo GRUB_DISABLE_SUBMENU=y
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ arch-chroot /mnt grub-install --target=i386-pc --recheck /dev/sda
Installing for i386-pc platform.
Installation finished. No error reported.
++ arch-chroot /mnt grub-mkconfig -o /boot/grub/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-linux
Found initrd image: /boot/initramfs-linux.img
Found fallback initrd image(s) in /boot:  initramfs-linux-fallback.img
Warning: os-prober will not be executed to detect other bootable partitions.
Systems on them will not be added to the GRUB boot configuration.
Check GRUB_DISABLE_OS_PROBER documentation entry.
done
++ '[' true == true ']'
++ echo -n '\EFI\grub\grubx64.efi'
++ arch-chroot /mnt systemctl set-default multi-user.target
Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/multi-user.target.
+ '[' -n bash ']'

+ execute_step custom_shell
+ local STEP=custom_shell
+ eval custom_shell
++ custom_shell
++ print_step 'custom_shell()'
++ STEP='custom_shell()'
++ echo ''
++ echo -e '\033[0;96m# custom_shell() step\033[0m'
++ echo ''
++ local CUSTOM_SHELL_PATH=
++ case "$CUSTOM_SHELL" in
++ '[' -n '' ']'
+ '[' -n '' ']'
+ execute_step packages
+ local STEP=packages
+ eval packages
++ packages
++ print_step 'packages()'
++ STEP='packages()'
++ echo ''
++ echo -e '\033[0;96m# packages() step\033[0m'
++ echo ''
++ '[' false == true ']'
+ '[' false == true ']'
+ '[' false == true ']'
+ execute_step systemd_units
+ local STEP=systemd_units
+ eval systemd_units
++ systemd_units
++ UNITS=()
++ IFS=' '
++ local UNITS
++ date -u '+%F %T'
[0;96m# custom_shell() step[0m


[0;96m# packages() step[0m

+ local 'END_TIMESTAMP=2022-01-28 13:03:12'
+++ date -d '2022-01-28 13:03:12' +%s
+++ date -d '2022-01-28 12:54:42' +%s
++ date -u -d @510 +%T
+ local INSTALLATION_TIME=00:08:30
+ echo -e 'Installation start \033[0;97m2022-01-28 12:54:42\033[0m, end \033[0;97m2022-01-28 13:03:12\033[0m, time \033[0;97m00:08:30\033[0m'
+ execute_step end
+ local STEP=end
+ eval end
++ end
++ echo ''
++ echo -e '\033[0;92mArch Linux installed successfully!\033[0m'
++ echo ''
++ '[' true == true ']'
++ REBOOT=true
++ set +e
++ (( i = 15 ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
Installation start [0;97m2022-01-28 12:54:42[0m, end [0;97m2022-01-28 13:03:12[0m, time [0;97m00:08:30[0m

[0;92mArch Linux installed successfully![0m

++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 10 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 10 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 9 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 9 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 8 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 8 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 7 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 7 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 6 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 6 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 5 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 5 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 4 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 4 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 3 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 3 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 2 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 2 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 1 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 1 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
Rebooting...

++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ set -e
++ '[' true == true ']'
++ echo Rebooting...
++ echo ''
++ copy_logs
+++ echo ''
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_LUKS_PASSWORD=
+++ echo changeme
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_ROOT_PASSWORD=changeme
+++ echo changeme
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_USER_PASSWORD=changeme
++ '[' -f alis.conf ']'
++ local SOURCE_FILE=alis.conf
++ local FILE=/mnt/var/log/alis/alis.conf
++ mkdir -p /mnt/var/log/alis
++ cp alis.conf /mnt/var/log/alis/alis.conf
++ chown root:root /mnt/var/log/alis/alis.conf
++ chmod 600 /mnt/var/log/alis/alis.conf
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -f alis.log ']'
++ local SOURCE_FILE=alis.log
++ local FILE=/mnt/var/log/alis/alis.log
++ mkdir -p /mnt/var/log/alis
++ cp alis.log /mnt/var/log/alis/alis.log
++ chown root:root /mnt/var/log/alis/alis.log
++ chmod 600 /mnt/var/log/alis/alis.log
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -f alis.asciinema ']'
++ do_reboot
++ umount -R /mnt/boot
++ umount -R /mnt
++ reboot
++ loadkeys de
+ execute_step facts
+ local STEP=facts
+ eval facts
++ facts
++ print_step 'facts()'
++ STEP='facts()'
++ echo ''
++ echo -e '\033[0;96m# facts() step\033[0m'
++ echo ''
++ facts_commons

++ '[' -d /sys/firmware/efi ']'
++ BIOS_TYPE=bios
++ '[' -f alis.asciinema -o -f alis-recovery.asciinema ']'
++ ASCIINEMA=false
+++ lscpu
+++ grep GenuineIntel
[0;96m# facts() step[0m

++ '[' -n '' ']'
+++ lscpu
+++ grep AuthenticAMD
++ '[' -n 'Vendor ID:                       AuthenticAMD' ']'
++ CPU_VENDOR=amd
+++ lspci -nn
+++ grep '\[03'
+++ grep -i intel
++ '[' -n '' ']'
+++ lspci -nn
+++ grep -i amd
+++ grep '\[03'
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i nvidia
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i vmware
++ '[' -n '00:02.0 VGA compatible controller [0300]: VMware SVGA II Adapter [15ad:0405]' ']'
++ GPU_VENDOR=vmware
+++ grep -i oracle
+++ systemd-detect-virt
++ '[' -n oracle ']'
++ VIRTUALBOX=true
+++ systemd-detect-virt
+++ grep -i vmware
++ '[' -n '' ']'
+++ whoami
++ USER_NAME_INSTALL=root
++ '[' root == root ']'
++ SYSTEM_INSTALLATION=true
+++ echo /dev/sda
+++ grep '^/dev/[a-z]d[a-z]'
++ '[' -n /dev/sda ']'

[0;96m# checks() step[0m

++ DEVICE_SATA=true
++ '[' auto == auto ']'
++ case "$GPU_VENDOR" in
++ case "$AUR_PACKAGE" in
++ AUR_COMMAND=paru
++ '[' auto == auto ']'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ BOOTLOADER=grub
+ execute_step checks
+ local STEP=checks
+ eval checks
++ checks
++ print_step 'checks()'
++ STEP='checks()'
++ echo ''
++ echo -e '\033[0;96m# checks() step\033[0m'
++ echo ''
++ check_facts
++ '[' bios == bios ']'
++ check_variables_list BOOTLOADER grub grub true true
++ local NAME=BOOTLOADER
++ local VALUE=grub
++ local VALUES=grub
++ local REQUIRED=true
++ local SINGLE=true
++ '[' true == '' -o true == true ']'
++ check_variables_value BOOTLOADER grub

++ local NAME=BOOTLOADER
++ local VALUE=grub
++ '[' -z grub ']'
++ [[ true == '' ]]
++ [[ true == \t\r\u\e ]]
++ [[ grub != '' ]]
++ [[ grub =~   ]]
+++ echo grub
+++ grep -F -w grub
++ '[' grub '!=' '' -a -z grub ']'
+ execute_step prepare
+ local STEP=prepare
+ eval prepare
++ prepare
++ print_step 'prepare()'
++ STEP='prepare()'
++ echo ''
++ echo -e '\033[0;96m# prepare() step\033[0m'
++ echo ''
++ configure_reflector
++ '[' false == false ']'
++ systemctl stop reflector.service
[0;96m# prepare() step[0m

++ configure_time
++ timedatectl set-ntp true
++ prepare_partition
++ set +e
++ mountpoint -q /mnt/boot
++ '[' 1 == 0 ']'
++ mountpoint -q /mnt
++ '[' 32 == 0 ']'
++ lvs vg-root
  Volume group "vg-root" not found
  Cannot process volume group vg-root
++ '[' 5 == 0 ']'
++ vgs vg
  Volume group "vg" not found
  Cannot process volume group vg
++ '[' 5 == 0 ']'
++ '[' -e /dev/mapper/cryptroot ']'
++ set -e
++ ask_passwords
++ '[' '' == ask ']'
++ '[' -n '' -a ask == ask ']'
++ '[' changeme == ask ']'
++ '[' changeme == ask ']'
++ configure_network
++ '[' -n '' ']'
++ ping -c 1 -i 2 -W 5 -w 30 mirrors.kernel.org
PING mirrors.pdx.kernel.org (198.145.21.9) 56(84) bytes of data.
64 bytes from mirrors.pdx.kernel.org (198.145.21.9): icmp_seq=1 ttl=63 time=174 ms

++ '[' 0 -ne 0 ']'
--- mirrors.pdx.kernel.org ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 174.296/174.296/174.296/0.000 ms

[0;96m# partition() step[0m

+ execute_step partition
+ local STEP=partition
+ eval partition
++ partition
++ print_step 'partition()'
++ STEP='partition()'
++ echo ''
++ echo -e '\033[0;96m# partition() step\033[0m'
++ echo ''
++ partprobe -s /dev/sda
/dev/sda: gpt partitions 1 2 3
++ partition_setup
++ '[' auto == auto ']'
++ PARTITION_PARTED_FILE_SYSTEM_TYPE=zfs
++ '[' zfs == f2fs ']'
++ '[' zfs == zfs ']'
++ PARTITION_PARTED_UEFI='#TODO'
++ PARTITION_PARTED_BIOS='mklabel gpt mkpart non-fs 0% 2 mkpart bpool 2 1000 mkpart rpool 1000 100% set 1 bios_grub on set 2 boot on'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ '[' true == true ']'
++ PARTITION_BOOT=/dev/sda1
++ PARTITION_ROOT=/dev/sda2
++ DEVICE_ROOT=/dev/sda2
++ '[' false == true ']'
++ '[' false == true ']'
++ '[' auto == custom -o auto == manual ']'
++ PARTITION_BOOT_NUMBER=/dev/sda1
++ PARTITION_ROOT_NUMBER=/dev/sda2
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ '[' zfs '!=' zfs ']'
++ '[' zfs == zfs ']'
++ load_zfs
++ curl -s https://eoli3n.github.io/archzfs/init
++ bash

[1m> Testing if archiso is running[0m

[1m> Increasing cowspace to half of RAM[0m

[1m> Adding archzfs repo[0m

[1m> Current kernel version is 5.15.12-arch1-1[0m

[1m> Searching zfs-linux on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Searching zfs-linux on http://archzfs.com/archive_archzfs/...[0m

[1m> Package "zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst" found[0m
/alis

[1m> Downloading to /tmp/zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst ...[0m

[1m> Extracting zfs-utils version from zfs-linux PKGINFO[0m

[1m> Searching zfs-utils on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Package "zfs-utils-2.1.2-1-x86_64.pkg.tar.zst" found[0m

[1m> Installing zfs-utils and zfs-linux[0m

[32mZFS is ready

+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda2
++ BOOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda3
++ ROOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ echo ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ create_zfs_datasets ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ ZFS_BOOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ ZFS_ROOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zpool create -f -o ashift=12 -d -o feature@async_destroy=enabled -o feature@bookmarks=enabled -o feature@embedded_data=enabled -o feature@empty_bpobj=enabled -o feature@enabled_txg=enabled -o feature@extensible_dataset=enabled -o feature@filesystem_limits=enabled -o feature@hole_birth=enabled -o feature@large_blocks=enabled -o feature@lz4_compress=enabled -o feature@spacemap_histogram=enabled -o feature@zpool_checkpoint=enabled -O acltype=posixacl -O canmount=off -O compression=lz4 -O devices=off -O normalization=formD -O relatime=on -O xattr=sa -O mountpoint=/boot -R /mnt bpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ echo changeme
++ zpool create -f -o ashift=12 -O acltype=posixacl -O relatime=on -O xattr=sa -O dnodesize=legacy -O normalization=formD -O mountpoint=none -O canmount=off -O devices=off -R /mnt -O compression=lz4 -O encryption=aes-256-gcm -O keyformat=passphrase -O keylocation=prompt rpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zfs create -o mountpoint=/boot bpool/boot
++ zfs create -o mountpoint=none rpool/data
++ zfs create -o mountpoint=none rpool/ROOT
++ zfs create -o mountpoint=/ -o canmount=noauto rpool/ROOT/default
++ zfs create -o mountpoint=/home rpool/data/home
++ zfs create -o mountpoint=/root rpool/data/home/root
++ zfs create -o mountpoint=/var -o canmount=off rpool/var
++ zfs create rpool/var/log
++ zfs create -o acltype=posixacl rpool/var/logjournal
++ zfs create -o mountpoint=/var/lib -o canmount=off rpool/var/lib
++ zfs create rpool/var/lib/libvirt
++ zfs create rpool/var/lib/docker
++ zpool export bpool
++ zpool export rpool
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3 -R /mnt rpool -N
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 -R /mnt bpool -N
++ echo changeme
++ zfs load-key rpool
++ zfs mount rpool/ROOT/default
++ zfs mount -a
++ zpool set bootfs=rpool/ROOT/default rpool
++ partition_options
++ PARTITION_OPTIONS_BOOT=defaults
++ PARTITION_OPTIONS=defaults
++ '[' true == true ']'
++ PARTITION_OPTIONS_BOOT=defaults,noatime
++ PARTITION_OPTIONS=defaults,noatime
++ '[' zfs == f2fs ']'
++ '[' zfs == btrfs ']'
++ partition_mount
++ '[' zfs == btrfs ']'
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ BOOT_DIRECTORY=/boot
++ ESP_DIRECTORY=/boot
+++ blkid -s UUID -o value /dev/sda1
++ UUID_BOOT=
+++ blkid -s UUID -o value /dev/sda2
++ UUID_ROOT=7316564931211648866
+++ blkid -s PARTUUID -o value /dev/sda1
++ PARTUUID_BOOT=a3caf38a-782c-43e8-9b05-e99d6a2fd018
+++ blkid -s PARTUUID -o value /dev/sda2
++ PARTUUID_ROOT=9c5498f2-e8b7-48b2-8254-bc366ab36abd

[0;96m# install() step[0m
+ execute_step install
+ local STEP=install
+ eval install
++ install
++ print_step 'install()'
++ STEP='install()'
++ echo ''
++ echo -e '\033[0;96m# install() step\033[0m'
++ echo ''
++ '[' -n 'https://mirrors.kernel.org/archlinux/$repo/os/$arch' ']'
++ echo 'Server = https://mirrors.kernel.org/archlinux/$repo/os/$arch'

++ '[' false == true ']'
++ sed -i s/#Color/Color/ /etc/pacman.conf
++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /etc/pacman.conf
++ pacstrap /mnt base base-devel linux linux-firmware
==> Creating install root at /mnt
==> Installing packages to /mnt
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: There are 24 members in group base-devel:
:: Repository core
   1) autoconf  2) automake  3) binutils  4) bison  5) fakeroot  6) file  7) findutils  8) flex  9) gawk  10) gcc  11) gettext  12) grep  13) groff  14) gzip  15) libtool  16) m4  17) make  18) pacman  19) patch  20) pkgconf  21) sed  22) sudo  23) texinfo  24) which

Enter a selection (default=all): 
resolving dependencies...
:: There are 3 providers available for initramfs:
:: Repository core
   1) mkinitcpio
:: Repository extra
   2) booster  3) dracut

Enter a number (default=1): 
looking for conflicting packages...

Packages (139) acl-2.3.1-1  archlinux-keyring-20220125-1  argon2-20190702-4  attr-2.5.1-1  audit-3.0.6-5  bash-5.1.016-1  brotli-1.0.9-7  bzip2-1.0.8-4  ca-certificates-20210603-1  ca-certificates-mozilla-3.74-1  ca-certificates-utils-20210603-1  coreutils-9.0-2  cryptsetup-2.4.3-1  curl-7.81.0-1  db-5.3.28-5  dbus-1.12.20-1  device-mapper-2.03.14-2  diffutils-3.8-1  e2fsprogs-1.46.5-1  elfutils-0.186-2  expat-2.4.3-1  filesystem-2021.12.07-1  gc-8.2.0-2  gcc-libs-11.1.0-3  gdbm-1.22-1  glib2-2.70.3-1  glibc-2.33-5  gmp-6.2.1-1  gnupg-2.2.32-2  gnutls-3.7.3-1  gpgme-1.16.0-3  guile-2.2.7-2  hwdata-0.355-1  iana-etc-20220110-1  icu-70.1-1  iproute2-5.16.0-1  iptables-1:1.8.7-1  iputils-20211215-1  json-c-0.15-2  kbd-2.4.0-2  keyutils-1.6.3-1  kmod-29-1  krb5-1.19.2-2  less-1:590-1  libarchive-3.5.2-2  libassuan-2.5.5-1  libcap-2.63-1  libcap-ng-0.8.2-6  libcroco-0.6.13-2  libelf-0.186-2  libffi-3.4.2-4  libgcrypt-1.9.4-1  libgpg-error-1.43-1  libidn2-2.3.2-1  libksba-1.6.0-1  libldap-2.6.1-1  libmnl-1.0.4-3  libmpc-1.2.1-1  libnetfilter_conntrack-1.0.8-1  libnfnetlink-1.0.1-4  libnftnl-1.2.1-1  libnghttp2-1.46.0-1  libnl-3.5.0-3  libp11-kit-0.24.1-1  libpcap-1.10.1-1  libpsl-0.21.1-1  libsasl-2.1.27-3  libseccomp-2.5.3-3  libsecret-0.20.4-1  libssh2-1.10.0-1  libsysprof-capture-3.42.1-2  libtasn1-4.18.0-1  libtirpc-1.3.2-1  libunistring-0.9.10-3  libxcrypt-4.4.27-1  libxml2-2.9.12-7  licenses-20220125-1  linux-api-headers-5.12.3-1  linux-firmware-whence-20220119.0c6a7b3-2  lz4-1:1.9.3-2  mkinitcpio-31-2  mkinitcpio-busybox-1.34.1-1  mpfr-4.1.0.p13-1  ncurses-6.3-1  nettle-3.7.3-1  npth-1.6-3  openssl-1.1.1.m-1  p11-kit-0.24.1-1  pacman-mirrorlist-20220116-1  pam-1.5.2-1  pambase-20211210-1  pciutils-3.7.0-2  pcre-8.45-1  pcre2-10.39-1  perl-5.34.0-3  pinentry-1.2.0-1  popt-1.18-2  procps-ng-3.3.17-1  psmisc-23.4-1  readline-8.1.001-1  shadow-4.8.1-4  sqlite-3.37.2-1  systemd-250.3-1  systemd-libs-250.3-1  systemd-sysvcompat-250.3-1  tar-1.34-1  tzdata-2021e-1  util-linux-2.37.3-1  util-linux-libs-2.37.3-1  xz-5.2.5-2  zlib-1:1.2.11-5  zstd-1.5.2-1  autoconf-2.71-1  automake-1.16.5-1  base-2-2  binutils-2.36.1-3  bison-3.8.2-1  fakeroot-1.27-1  file-5.41-1  findutils-4.8.0-1  flex-2.6.4-3  gawk-5.1.1-1  gcc-11.1.0-3  gettext-0.21-1  grep-3.7-1  groff-1.22.4-6  gzip-1.11-1  libtool-2.4.6+42+gb88cebd5-16  linux-5.16.2.arch1-1  linux-firmware-20220119.0c6a7b3-2  m4-1.4.19-1  make-4.3-3  pacman-6.0.1-3  patch-2.7.6-8  pkgconf-1.8.0-1  sed-4.8-1  sudo-1.9.8.p2-3  texinfo-6.8-2  which-2.21-5

Total Download Size:    477.67 MiB
Total Installed Size:  1116.91 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-5.16.2.arch1-1-x86_64 downloading...
 linux-firmware-20220119.0c6a7b3-2-any downloading...
 gcc-11.1.0-3-x86_64 downloading...
 gcc-libs-11.1.0-3-x86_64 downloading...
 perl-5.34.0-3-x86_64 downloading...
 icu-70.1-1-x86_64 downloading...
 glibc-2.33-5-x86_64 downloading...
 systemd-250.3-1-x86_64 downloading...
 guile-2.2.7-2-x86_64 downloading...
 binutils-2.36.1-3-x86_64 downloading...
 openssl-1.1.1.m-1-x86_64 downloading...
 glib2-2.70.3-1-x86_64 downloading...
 gnutls-3.7.3-1-x86_64 downloading...
 coreutils-9.0-2-x86_64 downloading...
 gnupg-2.2.32-2-x86_64 downloading...
 util-linux-2.37.3-1-x86_64 downloading...
 groff-1.22.4-6-x86_64 downloading...
 gettext-0.21-1-x86_64 downloading...
 sqlite-3.37.2-1-x86_64 downloading...
 bash-5.1.016-1-x86_64 downloading...
 sudo-1.9.8.p2-3-x86_64 downloading...
 texinfo-6.8-2-x86_64 downloading...
 libxml2-2.9.12-7-x86_64 downloading...
 krb5-1.19.2-2-x86_64 downloading...
 kbd-2.4.0-2-x86_64 downloading...
 e2fsprogs-1.46.5-1-x86_64 downloading...
 shadow-4.8.1-4-x86_64 downloading...
 gawk-5.1.1-1-x86_64 downloading...
 ncurses-6.3-1-x86_64 downloading...
 linux-api-headers-5.12.3-1-any downloading...
 curl-7.81.0-1-x86_64 downloading...
 pcre2-10.39-1-x86_64 downloading...
 db-5.3.28-5-x86_64 downloading...
 iproute2-5.16.0-1-x86_64 downloading...
 archlinux-keyring-20220125-1-any downloading...
 pcre-8.45-1-x86_64 downloading...
 pacman-6.0.1-3-x86_64 downloading...
 tar-1.34-1-x86_64 downloading...
 bison-3.8.2-1-x86_64 downloading...
 zstd-1.5.2-1-x86_64 downloading...
 autoconf-2.71-1-any downloading...
 libunistring-0.9.10-3-x86_64 downloading...
 systemd-libs-250.3-1-x86_64 downloading...
 automake-1.16.5-1-any downloading...
 cryptsetup-2.4.3-1-x86_64 downloading...
 pam-1.5.2-1-x86_64 downloading...
 elfutils-0.186-2-x86_64 downloading...
 libgcrypt-1.9.4-1-x86_64 downloading...
 libelf-0.186-2-x86_64 downloading...
 procps-ng-3.3.17-1-x86_64 downloading...
 libarchive-3.5.2-2-x86_64 downloading...
 findutils-4.8.0-1-x86_64 downloading...
 make-4.3-3-x86_64 downloading...
 hwdata-0.355-1-any downloading...
 libp11-kit-0.24.1-1-x86_64 downloading...
 gpgme-1.16.0-3-x86_64 downloading...
 gmp-6.2.1-1-x86_64 downloading...
 iptables-1:1.8.7-1-x86_64 downloading...
 nettle-3.7.3-1-x86_64 downloading...
 libtool-2.4.6+42+gb88cebd5-16-x86_64 downloading...
 mpfr-4.1.0.p13-1-x86_64 downloading...
 libnl-3.5.0-3-x86_64 downloading...
 tzdata-2021e-1-x86_64 downloading...
 iana-etc-20220110-1-any downloading...
 brotli-1.0.9-7-x86_64 downloading...
 audit-3.0.6-5-x86_64 downloading...
 diffutils-3.8-1-x86_64 downloading...
 file-5.41-1-x86_64 downloading...
 util-linux-libs-2.37.3-1-x86_64 downloading...
 ca-certificates-mozilla-3.74-1-x86_64 downloading...
 readline-8.1.001-1-x86_64 downloading...
 dbus-1.12.20-1-x86_64 downloading...
 xz-5.2.5-2-x86_64 downloading...
 flex-2.6.4-3-x86_64 downloading...
 device-mapper-2.03.14-2-x86_64 downloading...
 libldap-2.6.1-1-x86_64 downloading...
 libpcap-1.10.1-1-x86_64 downloading...
 mkinitcpio-busybox-1.34.1-1-x86_64 downloading...
 gdbm-1.22-1-x86_64 downloading...
 m4-1.4.19-1-x86_64 downloading...
 grep-3.7-1-x86_64 downloading...
 libsecret-0.20.4-1-x86_64 downloading...
 sed-4.8-1-x86_64 downloading...
 libgpg-error-1.43-1-x86_64 downloading...
 gc-8.2.0-2-x86_64 downloading...
 libssh2-1.10.0-1-x86_64 downloading...
 psmisc-23.4-1-x86_64 downloading...
 libtirpc-1.3.2-1-x86_64 downloading...
 libcroco-0.6.13-2-x86_64 downloading...
 libsasl-2.1.27-3-x86_64 downloading...
 p11-kit-0.24.1-1-x86_64 downloading...
 libidn2-2.3.2-1-x86_64 downloading...
 libksba-1.6.0-1-x86_64 downloading...
 acl-2.3.1-1-x86_64 downloading...
 iputils-20211215-1-x86_64 downloading...
 libtasn1-4.18.0-1-x86_64 downloading...
 pinentry-1.2.0-1-x86_64 downloading...
 lz4-1:1.9.3-2-x86_64 downloading...
 expat-2.4.3-1-x86_64 downloading...
 less-1:590-1-x86_64 downloading...
 libassuan-2.5.5-1-x86_64 downloading...
 kmod-29-1-x86_64 downloading...
 keyutils-1.6.3-1-x86_64 downloading...
 pciutils-3.7.0-2-x86_64 downloading...
 libnghttp2-1.46.0-1-x86_64 downloading...
 patch-2.7.6-8-x86_64 downloading...
 zlib-1:1.2.11-5-x86_64 downloading...
 libxcrypt-4.4.27-1-x86_64 downloading...
 libseccomp-2.5.3-3-x86_64 downloading...
 libcap-2.63-1-x86_64 downloading...
 gzip-1.11-1-x86_64 downloading...
 libpsl-0.21.1-1-x86_64 downloading...
 popt-1.18-2-x86_64 downloading...
 libmpc-1.2.1-1-x86_64 downloading...
 fakeroot-1.27-1-x86_64 downloading...
 libnftnl-1.2.1-1-x86_64 downloading...
 licenses-20220125-1-any downloading...
 attr-2.5.1-1-x86_64 downloading...
 pkgconf-1.8.0-1-x86_64 downloading...
 bzip2-1.0.8-4-x86_64 downloading...
 json-c-0.15-2-x86_64 downloading...
 libnetfilter_conntrack-1.0.8-1-x86_64 downloading...
 libsysprof-capture-3.42.1-2-x86_64 downloading...
 libffi-3.4.2-4-x86_64 downloading...
 mkinitcpio-31-2-any downloading...
 libcap-ng-0.8.2-6-x86_64 downloading...
 argon2-20190702-4-x86_64 downloading...
 linux-firmware-whence-20220119.0c6a7b3-2-any downloading...
 npth-1.6-3-x86_64 downloading...
 libnfnetlink-1.0.1-4-x86_64 downloading...
 which-2.21-5-x86_64 downloading...
 filesystem-2021.12.07-1-x86_64 downloading...
 libmnl-1.0.4-3-x86_64 downloading...
 ca-certificates-utils-20210603-1-any downloading...
 pacman-mirrorlist-20220116-1-any downloading...
 systemd-sysvcompat-250.3-1-x86_64 downloading...
 pambase-20211210-1-any downloading...
 base-2-2-any downloading...
 ca-certificates-20210603-1-any downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing iana-etc...
installing filesystem...
warning: directory permissions differ on /mnt/root/
filesystem: 755  package: 750
installing linux-api-headers...
installing tzdata...
installing glibc...
Optional dependencies for glibc
    gd: for memusagestat
installing gcc-libs...
installing ncurses...
Optional dependencies for ncurses
    bash: for ncursesw6-config [pending]
installing readline...
installing bash...
Optional dependencies for bash
    bash-completion: for tab completion
installing attr...
installing acl...
installing gmp...
installing util-linux-libs...
installing e2fsprogs...
installing openssl...
Optional dependencies for openssl
    ca-certificates [pending]
    perl [pending]
installing libsasl...
installing libldap...
installing keyutils...
installing krb5...
installing libtirpc...
installing pambase...
installing libcap-ng...
installing audit...
installing libxcrypt...
installing pam...
installing libcap...
installing coreutils...
installing zlib...
installing xz...
installing bzip2...
installing libseccomp...
installing file...
installing findutils...
installing mpfr...
installing gawk...
installing pcre...
installing grep...
installing libgpg-error...
installing libgcrypt...
installing libtasn1...
installing libffi...
installing libp11-kit...
installing lz4...
installing zstd...
installing systemd-libs...
installing procps-ng...
installing sed...
installing tar...
installing libsysprof-capture...
installing glib2...
Optional dependencies for glib2
    python: gdbus-codegen, glib-genmarshal, glib-mkenums, gtester-report
    libelf: gresource inspection tool [pending]
installing libunistring...
installing icu...
installing libxml2...
installing libcroco...
installing gettext...
Optional dependencies for gettext
    git: for autopoint infrastructure updates
installing hwdata...
installing kmod...
installing pciutils...
installing psmisc...
installing shadow...
installing util-linux...
Optional dependencies for util-linux
    python: python bindings to libmount
    words: default dictionary for look
installing pcre2...
installing less...
installing gzip...
installing licenses...
installing expat...
installing libarchive...
installing p11-kit...
installing ca-certificates-utils...
installing ca-certificates-mozilla...
installing ca-certificates...
installing brotli...
installing libidn2...
installing libnghttp2...
installing libpsl...
installing libssh2...
installing curl...
installing npth...
installing libksba...
installing libassuan...
installing libsecret...
Optional dependencies for libsecret
    org.freedesktop.secrets: secret storage backend
installing pinentry...
Optional dependencies for pinentry
    gtk2: gtk2 backend
    qt5-base: qt backend
    gcr: gnome3 backend
installing nettle...
installing gnutls...
Optional dependencies for gnutls
    guile: for use with Guile bindings [pending]
installing sqlite...
installing gnupg...
Optional dependencies for gnupg
    libldap: gpg2keys_ldap [installed]
    libusb-compat: scdaemon
    pcsclite: scdaemon
installing gpgme...
installing pacman-mirrorlist...
installing archlinux-keyring...
installing pacman...
Optional dependencies for pacman
    perl-locale-gettext: translation support in makepkg-template
installing device-mapper...
installing popt...
installing json-c...
installing argon2...
installing cryptsetup...
installing dbus...
installing libmnl...
installing libnftnl...
installing libnl...
installing libpcap...
installing libnfnetlink...
installing libnetfilter_conntrack...
installing iptables...
installing kbd...
installing libelf...
installing systemd...
Initializing machine ID from random generator.
Creating group 'sys' with GID 3.
Creating group 'mem' with GID 8.
Creating group 'ftp' with GID 11.
Creating group 'mail' with GID 12.
Creating group 'log' with GID 19.
Creating group 'smmsp' with GID 25.
Creating group 'proc' with GID 26.
Creating group 'games' with GID 50.
Creating group 'lock' with GID 54.
Creating group 'network' with GID 90.
Creating group 'floppy' with GID 94.
Creating group 'scanner' with GID 96.
Creating group 'power' with GID 98.
Creating group 'nobody' with GID 65534.
Creating group 'adm' with GID 999.
Creating group 'wheel' with GID 998.
Creating group 'utmp' with GID 997.
Creating group 'audio' with GID 996.
Creating group 'disk' with GID 995.
Creating group 'input' with GID 994.
Creating group 'kmem' with GID 993.
Creating group 'kvm' with GID 992.
Creating group 'lp' with GID 991.
Creating group 'optical' with GID 990.
Creating group 'render' with GID 989.
Creating group 'sgx' with GID 988.
Creating group 'storage' with GID 987.
Creating group 'tty' with GID 5.
Creating group 'uucp' with GID 986.
Creating group 'video' with GID 985.
Creating group 'users' with GID 984.
Creating group 'systemd-journal' with GID 983.
Creating group 'rfkill' with GID 982.
Creating group 'bin' with GID 1.
Creating user 'bin' (n/a) with UID 1 and GID 1.
Creating group 'daemon' with GID 2.
Creating user 'daemon' (n/a) with UID 2 and GID 2.
Creating user 'mail' (n/a) with UID 8 and GID 12.
Creating user 'ftp' (n/a) with UID 14 and GID 11.
Creating group 'http' with GID 33.
Creating user 'http' (n/a) with UID 33 and GID 33.
Creating user 'nobody' (Nobody) with UID 65534 and GID 65534.
Creating group 'dbus' with GID 81.
Creating user 'dbus' (System Message Bus) with UID 81 and GID 81.
Creating group 'systemd-coredump' with GID 981.
Creating user 'systemd-coredump' (systemd Core Dumper) with UID 981 and GID 981.
Creating group 'systemd-network' with GID 980.
Creating user 'systemd-network' (systemd Network Management) with UID 980 and GID 980.
Creating group 'systemd-oom' with GID 979.
Creating user 'systemd-oom' (systemd Userspace OOM Killer) with UID 979 and GID 979.
Creating group 'systemd-journal-remote' with GID 978.
Creating user 'systemd-journal-remote' (systemd Journal Remote) with UID 978 and GID 978.
Creating group 'systemd-resolve' with GID 977.
Creating user 'systemd-resolve' (systemd Resolver) with UID 977 and GID 977.
Creating group 'systemd-timesync' with GID 976.
Creating user 'systemd-timesync' (systemd Time Synchronization) with UID 976 and GID 976.
Creating group 'uuidd' with GID 68.
Creating user 'uuidd' (n/a) with UID 68 and GID 68.
Created symlink /etc/systemd/system/getty.target.wants/getty@tty1.service → /usr/lib/systemd/system/getty@.service.
Created symlink /etc/systemd/system/multi-user.target.wants/remote-fs.target → /usr/lib/systemd/system/remote-fs.target.
:: Append 'init=/usr/lib/systemd/systemd' to your kernel command line in your
   bootloader to replace sysvinit with systemd, or install systemd-sysvcompat
Optional dependencies for systemd
    libmicrohttpd: remote journald capabilities
    quota-tools: kernel-level quota management
    systemd-sysvcompat: symlink package to provide sysvinit binaries [pending]
    polkit: allow administration as unprivileged user
    curl: machinectl pull-tar and pull-raw [installed]
    libfido2: unlocking LUKS2 volumes with FIDO2 token
    tpm2-tss: unlocking LUKS2 volumes with TPM2
installing systemd-sysvcompat...
installing iputils...
installing iproute2...
Optional dependencies for iproute2
    db: userspace arp daemon [pending]
    libcap: tipc [installed]
    linux-atm: ATM support
installing base...
Optional dependencies for base
    linux: bare metal support [pending]
installing m4...
installing diffutils...
installing gdbm...
installing db...
installing perl...
installing autoconf...
installing automake...
installing elfutils...
installing binutils...
installing bison...
installing fakeroot...
installing flex...
installing libmpc...
installing gcc...
Optional dependencies for gcc
    lib32-gcc-libs: for generating code for 32-bit ABI
installing groff...
Optional dependencies for groff
    netpbm: for use together with man -H command interaction in browsers
    psutils: for use together with man -H command interaction in browsers
    libxaw: for gxditview
    perl-file-homedir: for use with glilypond
installing libtool...
installing texinfo...
installing gc...
installing guile...
installing make...
installing patch...
Optional dependencies for patch
    ed: for patch -e functionality
installing pkgconf...
installing sudo...
installing which...
installing mkinitcpio-busybox...
installing mkinitcpio...
Optional dependencies for mkinitcpio
    gzip: Use gzip compression for the initramfs image [installed]
    xz: Use lzma or xz compression for the initramfs image [installed]
    bzip2: Use bzip2 compression for the initramfs image [installed]
    lzop: Use lzo compression for the initramfs image
    lz4: Use lz4 compression for the initramfs image [installed]
    mkinitcpio-nfs-utils: Support for root filesystem on NFS
installing linux...
Optional dependencies for linux
    crda: to set the correct wireless channels of your country
    linux-firmware: firmware images needed for some devices [pending]
installing linux-firmware-whence...
installing linux-firmware...
:: Running post-transaction hooks...
( 1/14) Creating system user accounts...
( 2/14) Updating journal message catalog...
( 3/14) Reloading system manager configuration...
  Skipped: Running in chroot.
( 4/14) Updating udev hardware database...
( 5/14) Applying kernel sysctl settings...
  Skipped: Running in chroot.
( 6/14) Creating temporary files...
( 7/14) Reloading device manager configuration...
  Skipped: Running in chroot.
( 8/14) Arming ConditionNeedsUpdate...
( 9/14) Rebuilding certificate stores...
(10/14) Updating module dependencies...
(11/14) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> ERROR: file not found: `fsck.zfs'
==> WARNING: No fsck helpers found. fsck will not be run on boot.
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> WARNING: errors were encountered during the build. The image may not be complete.
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
error: command failed to execute correctly
(12/14) Reloading system bus configuration...
  Skipped: Running in chroot.
(13/14) Warn about old perl modules
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_MESSAGES = "",
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
(14/14) Updating the info directory file...
++ '[' zfs == zfs ']'
++ cat
++ sed -i s/#Color/Color/ /mnt/etc/pacman.conf
++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /mnt/etc/pacman.conf
++ '[' false == true ']'
+ execute_step configure_zfs
+ local STEP=configure_zfs
+ eval configure_zfs
++ configure_zfs
++ pacman_install zfs-linux
++ local ERROR=true
++ set +e
++ PACKAGES=('zfs-linux')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ execute_sudo 'pacman -Syu --noconfirm --needed zfs-linux'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zfs-linux'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) zfs-utils-2.1.2-1  zfs-linux-2.1.2_5.16.2.arch1.1-1

Total Download Size:   48.77 MiB
Total Installed Size:  60.28 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 zfs-utils-2.1.2-1-x86_64 downloading...
 zfs-linux-2.1.2_5.16.2.arch1.1-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing zfs-utils...
Optional dependencies for zfs-utils
    python: pyzfs and extra utilities,
    python-cffi: pyzfs
installing zfs-linux...
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Updating module dependencies...
(5/5) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache rpool
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache bpool
++ arch-chroot /mnt systemctl enable zfs-import-cache zfs-import.target zfs-mount zfs-zed zfs.target
Created symlink /etc/systemd/system/zfs-import.target.wants/zfs-import-cache.service → /usr/lib/systemd/system/zfs-import-cache.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-import.target → /usr/lib/systemd/system/zfs-import.target.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-mount.service → /usr/lib/systemd/system/zfs-mount.service.
Created symlink /etc/systemd/system/zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/multi-user.target.wants/zfs.target → /usr/lib/systemd/system/zfs.target.

[0;96m# configuration() step[0m

+ execute_step configuration
+ local STEP=configuration
+ eval configuration
++ configuration
++ print_step 'configuration()'
++ STEP='configuration()'
++ echo ''
++ echo -e '\033[0;96m# configuration() step\033[0m'
++ echo ''
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ '[' true == true ']'
++ '[' zfs == f2fs ']'
++ sed -i s/relatime/noatime/ /mnt/etc/fstab
++ arch-chroot /mnt systemctl enable fstrim.timer
Created symlink /etc/systemd/system/timers.target.wants/fstrim.timer → /usr/lib/systemd/system/fstrim.timer.
++ arch-chroot /mnt ln -s -f /usr/share/zoneinfo/Europe/Berlin /etc/localtime
++ arch-chroot /mnt hwclock --systohc
++ for LOCALE in "${LOCALES[@]}"
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /mnt/etc/locale.gen
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANG=en_US.UTF-8
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANGUAGE=en_US:en
++ locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ arch-chroot /mnt locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ echo -e 'KEYMAP=en\n\n'
++ echo archlinux
++ local OPTIONS=
++ '[' -n en ']'
++ local 'OPTIONS=
    Option "XkbLayout" "en"'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ arch-chroot /mnt mkdir -p /etc/X11/xorg.conf.d/
++ cat
++ '[' -n '' ']'
++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd
New password: Retype new password: passwd: password updated successfully
+ execute_step mkinitcpio_configuration

+ local STEP=mkinitcpio_configuration
+ eval mkinitcpio_configuration
++ mkinitcpio_configuration
++ print_step 'mkinitcpio_configuration()'
++ STEP='mkinitcpio_configuration()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio_configuration() step\033[0m'
++ echo ''
++ '[' true == true ']'
++ local MKINITCPIO_KMS_MODULES=
++ case "$DISPLAY_DRIVER" in
++ local 'MODULES=!vmd '
++ '[' auto == intel ']'
++ '[' false == true ']'
++ '[' zfs == btrfs ']'
++ '[' zfs == xfs ']'
++ '[' zfs == f2fs ']'
++ '[' zfs == reiserfs ']'
++ '[' false == true ']'
++ '[' grub == systemd ']'
[0;96m# mkinitcpio_configuration() step[0m

+++ sed 's/!udev/udev/'
+++ echo 'base !udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++ HOOKS='base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!usr/usr/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!keymap/keymap/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!consolefont/consolefont/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++ '[' -n '' ']'
+++ sanitize_variable 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ local 'VARIABLE=base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++++ sed 's/![^ ]*//g'
++++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ local 'VARIABLE=base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ echo 'base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/^[[:space:]]*//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/[[:space:]]*$//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++ HOOKS='base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ sanitize_variable '!vmd '
+++ local 'VARIABLE=!vmd '
++++ echo '!vmd '
++++ sed 's/![^ ]*//g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed 's/^[[:space:]]*//'
+++ local VARIABLE=
++++ echo ''
++++ sed 's/[[:space:]]*$//'
+++ local VARIABLE=
+++ echo ''
++ MODULES=
++ arch-chroot /mnt sed -i 's/^HOOKS=(.*)$/HOOKS=(base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems)/' /etc/mkinitcpio.conf
++ arch-chroot /mnt sed -i 's/^MODULES=(.*)/MODULES=()/' /etc/mkinitcpio.conf
++ '[' zstd '!=' '' ']'
++ arch-chroot /mnt sed -i 's/^#COMPRESSION="zstd"/COMPRESSION="zstd"/' /etc/mkinitcpio.conf
++ '[' zstd == bzip2 ']'
++ '[' zstd == lzma -o zstd == xz ']'
++ '[' zstd == lzop ']'
++ '[' zstd == lz4 ']'
++ '[' zstd == zstd ']'
++ pacman_install zstd
++ local ERROR=true
++ set +e
++ PACKAGES=('zstd')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ execute_sudo 'pacman -Syu --noconfirm --needed zstd'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zstd'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
warning: zstd-1.5.2-1 is up to date -- skipping
 there is nothing to do
++ '[' 0 == 0 ']'

++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
+ execute_step users
+ local STEP=users
+ eval users
++ users
++ print_step 'users()'
++ STEP='users()'
++ echo ''
++ echo -e '\033[0;96m# users() step\033[0m'
++ echo ''
++ local USERS_GROUPS=wheel,storage,optical
++ create_user pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USERS_GROUPS=wheel,storage,optical
[0;96m# users() step[0m

++ '[' false == true ']'
++ create_user_useradd pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USER_GROUPS=wheel,storage,optical
++ arch-chroot /mnt useradd -m -G wheel,storage,optical -s /bin/bash pai
++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd pai
New password: Retype new password: passwd: password updated successfully
++ arch-chroot /mnt sed -i 's/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/' /etc/sudoers
++ pacman_install xdg-user-dirs
++ local ERROR=true
++ set +e
++ PACKAGES=('xdg-user-dirs')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ execute_sudo 'pacman -Syu --noconfirm --needed xdg-user-dirs'
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed xdg-user-dirs'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (1) xdg-user-dirs-0.17-3

Total Download Size:   0.04 MiB
Total Installed Size:  0.15 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 xdg-user-dirs-0.17-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing xdg-user-dirs...
Created symlink /etc/systemd/user/default.target.wants/xdg-user-dirs-update.service → /usr/lib/systemd/user/xdg-user-dirs-update.service.
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e

[0;96m# display_driver() step[0m

++ '[' false == true ']'
++ '[' false == true ']'
+ '[' -n auto ']'
+ execute_step display_driver
+ local STEP=display_driver
+ eval display_driver
++ display_driver
++ print_step 'display_driver()'
++ STEP='display_driver()'
++ echo ''
++ echo -e '\033[0;96m# display_driver() step\033[0m'
++ echo ''
++ local PACKAGES_DRIVER_PACMAN=true
++ local PACKAGES_DRIVER=
++ local PACKAGES_DRIVER_MULTILIB=
++ local PACKAGES_DDX=
++ local PACKAGES_VULKAN=
++ local PACKAGES_VULKAN_MULTILIB=
++ local PACKAGES_HARDWARE_ACCELERATION=
++ local PACKAGES_HARDWARE_ACCELERATION_MULTILIB=
++ case "$DISPLAY_DRIVER" in
++ '[' false == true ']'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ pacman_install 'mesa    '
++ local ERROR=true
++ set +e
++ PACKAGES=('mesa    ')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ execute_sudo 'pacman -Syu --noconfirm --needed mesa    '
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed mesa    '
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...
warning: dependency cycle detected:
warning: libglvnd will be installed before its mesa dependency

Packages (22) libdrm-2.4.109-1  libedit-20210910_3.1-1  libglvnd-1.4.0-1  libomxil-bellagio-0.9.3-3  libpciaccess-0.16-2  libunwind-1.6.2-1  libx11-1.7.3.1-1  libxau-1.0.9-3  libxcb-1.14-1  libxdamage-1.1.5-3  libxdmcp-1.1.3-3  libxext-1.3.4-3  libxfixes-6.0.0-1  libxshmfence-1.3-2  libxxf86vm-1.1.4-4  llvm-libs-13.0.0-6  lm_sensors-1:3.6.0.r41.g31d1f125-1  vulkan-icd-loader-1.2.203-1  wayland-1.20.0-1  xcb-proto-1.14.1-5  xorgproto-2021.5-1  mesa-21.3.5-1

Total Download Size:    47.23 MiB
Total Installed Size:  225.80 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 llvm-libs-13.0.0-6-x86_64 downloading...
 mesa-21.3.5-1-x86_64 downloading...
 libx11-1.7.3.1-1-x86_64 downloading...
 libxcb-1.14-1-x86_64 downloading...
 libglvnd-1.4.0-1-x86_64 downloading...
 libdrm-2.4.109-1-x86_64 downloading...
 xorgproto-2021.5-1-any downloading...
 lm_sensors-1:3.6.0.r41.g31d1f125-1-x86_64 downloading...
 wayland-1.20.0-1-x86_64 downloading...
 libomxil-bellagio-0.9.3-3-x86_64 downloading...
 vulkan-icd-loader-1.2.203-1-x86_64 downloading...
 libunwind-1.6.2-1-x86_64 downloading...
 libedit-20210910_3.1-1-x86_64 downloading...
 xcb-proto-1.14.1-5-any downloading...
 libxext-1.3.4-3-x86_64 downloading...
 libxdmcp-1.1.3-3-x86_64 downloading...
 libpciaccess-0.16-2-x86_64 downloading...
 libxxf86vm-1.1.4-4-x86_64 downloading...
 libxfixes-6.0.0-1-x86_64 downloading...
 libxau-1.0.9-3-x86_64 downloading...
 libxdamage-1.1.5-3-x86_64 downloading...
 libxshmfence-1.3-2-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libpciaccess...
installing libdrm...
installing wayland...
installing xcb-proto...
installing libxdmcp...
installing libxau...
installing libxcb...
installing xorgproto...
installing libx11...
installing libxext...
installing libxxf86vm...
installing libxfixes...
installing libxdamage...
installing libxshmfence...
installing libomxil-bellagio...
installing libunwind...
installing libedit...
installing llvm-libs...
installing lm_sensors...
Optional dependencies for lm_sensors
    rrdtool: for logging with sensord
    perl: for sensor detection and configuration convert [installed]
installing libglvnd...
installing vulkan-icd-loader...
Optional dependencies for vulkan-icd-loader
    vulkan-driver: packaged vulkan driver
installing mesa...
Optional dependencies for mesa
    opengl-man-pages: for the OpenGL API man pages
    mesa-vdpau: for accelerated video playback
    libva-mesa-driver: for accelerated video playback
:: Running post-transaction hooks...
(1/2) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/2) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ '[' false == true ']'
+ execute_step kernels
+ local STEP=kernels
+ eval kernels
++ kernels
++ print_step 'kernels()'
++ STEP='kernels()'
++ echo ''
++ echo -e '\033[0;96m# kernels() step\033[0m'
++ echo ''
++ pacman_install linux-headers
++ local ERROR=true
++ set +e
++ PACKAGES=('linux-headers')
++ IFS=' '
++ local PACKAGES

[0;96m# kernels() step[0m

++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ execute_sudo 'pacman -Syu --noconfirm --needed linux-headers'
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed linux-headers'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (4) libnsl-2.0.0-1  pahole-1.23-1  python-3.10.2-1  linux-headers-5.16.2.arch1-1

Total Download Size:    37.43 MiB
Total Installed Size:  194.23 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-headers-5.16.2.arch1-1-x86_64 downloading...
 python-3.10.2-1-x86_64 downloading...
 pahole-1.23-1-x86_64 downloading...
 libnsl-2.0.0-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libnsl...
installing python...
Optional dependencies for python
    python-setuptools
    python-pip
    sqlite [installed]
    mpdecimal: for decimal
    xz: for lzma [installed]
    tk: for tkinter
installing pahole...
installing linux-headers...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating module dependencies...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ '[' -n '' ']'
+ execute_step mkinitcpio
+ local STEP=mkinitcpio
+ eval mkinitcpio

[0;96m# mkinitcpio() step[0m

++ mkinitcpio
++ print_step 'mkinitcpio()'
++ STEP='mkinitcpio()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio() step\033[0m'
++ echo ''
++ arch-chroot /mnt mkinitcpio -P
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [autodetect]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: wd719x
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
+ execute_step network
+ local STEP=network
+ eval network
++ network
++ print_step 'network()'
++ STEP='network()'
++ echo ''
++ echo -e '\033[0;96m# network() step\033[0m'
++ echo ''
++ pacman_install networkmanager
++ local ERROR=true
++ set +e
++ PACKAGES=('networkmanager')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'
++ execute_sudo 'pacman -Syu --noconfirm --needed networkmanager'
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'

[0;96m# network() step[0m

++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed networkmanager'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (18) bluez-libs-5.63-1  gpm-1.20.7.r38.ge82d1a6-4  jansson-2.14-1  libdaemon-0.14-5  libmm-glib-1.18.4-1  libndp-1.8-1  libnewt-0.52.21-8  libnm-1.34.0-1  libpgm-5.3.128-1  libsodium-1.0.18-2  libteam-1.31-5  mobile-broadband-provider-info-20210805-1  nspr-4.33-1  nss-3.74-1  slang-2.3.2-2  wpa_supplicant-2:2.10-1  zeromq-4.3.4-2  networkmanager-1.34.0-1

Total Download Size:   10.98 MiB
Total Installed Size:  60.62 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 networkmanager-1.34.0-1-x86_64 downloading...
 nss-3.74-1-x86_64 downloading...
 wpa_supplicant-2:2.10-1-x86_64 downloading...
 libnm-1.34.0-1-x86_64 downloading...
 slang-2.3.2-2-x86_64 downloading...
 libmm-glib-1.18.4-1-x86_64 downloading...
 zeromq-4.3.4-2-x86_64 downloading...
 libteam-1.31-5-x86_64 downloading...
 nspr-4.33-1-x86_64 downloading...
 libpgm-5.3.128-1-x86_64 downloading...
 libsodium-1.0.18-2-x86_64 downloading...
 gpm-1.20.7.r38.ge82d1a6-4-x86_64 downloading...
 libnewt-0.52.21-8-x86_64 downloading...
 bluez-libs-5.63-1-x86_64 downloading...
 mobile-broadband-provider-info-20210805-1-any downloading...
 jansson-2.14-1-x86_64 downloading...
 libndp-1.8-1-x86_64 downloading...
 libdaemon-0.14-5-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing nspr...
installing nss...
installing jansson...
installing libnm...
installing wpa_supplicant...
installing libmm-glib...
installing gpm...
installing slang...
installing libnewt...
Optional dependencies for libnewt
    python: libnewt support with the _snack module [installed]
    tcl: whiptcl support
installing libndp...
installing libdaemon...
installing libsodium...
installing libpgm...
installing zeromq...
installing libteam...
installing bluez-libs...
installing mobile-broadband-provider-info...
installing networkmanager...
Optional dependencies for networkmanager
    polkit: let non-root users control networking
    dnsmasq: connection sharing
    nftables: connection sharing
    iptables: connection sharing [installed]
    bluez: Bluetooth support
    ppp: dialup connection support
    modemmanager: cellular network support
    iwd: wpa_supplicant alternative
    dhclient: alternative DHCP client
    dhcpcd: alternative DHCP client
    openresolv: alternative resolv.conf manager
    firewalld: firewall support
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Reloading system bus configuration...
  Skipped: Running in chroot.
(5/5) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable NetworkManager.service
Created symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service → /usr/lib/systemd/system/NetworkManager.service.
Created symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service → /usr/lib/systemd/system/NetworkManager-dispatcher.service.
Created symlink /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service → /usr/lib/systemd/system/NetworkManager-wait-online.service.
+ '[' true == true ']'
+ execute_step virtualbox

[0;96m# virtualbox() step[0m

+ local STEP=virtualbox
+ eval virtualbox
++ virtualbox
++ print_step 'virtualbox()'
++ STEP='virtualbox()'
++ echo ''
++ echo -e '\033[0;96m# virtualbox() step\033[0m'
++ echo ''
++ pacman_install virtualbox-guest-utils
++ local ERROR=true
++ set +e
++ PACKAGES=('virtualbox-guest-utils')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ execute_sudo 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (10) libice-1.0.10-3  libsm-1.2.3-2  libxcomposite-0.4.5-3  libxmu-1.1.3-2  libxrandr-1.5.2-3  libxrender-0.9.10-4  libxt-1.2.1-1  xf86-video-vmware-13.3.0-3  xorg-xrandr-1.5.1-2  virtualbox-guest-utils-6.1.32-1

Total Download Size:    2.13 MiB
Total Installed Size:  12.55 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 virtualbox-guest-utils-6.1.32-1-x86_64 downloading...
 libxt-1.2.1-1-x86_64 downloading...
 libice-1.0.10-3-x86_64 downloading...
 xf86-video-vmware-13.3.0-3-x86_64 downloading...
 libxmu-1.1.3-2-x86_64 downloading...
 libsm-1.2.3-2-x86_64 downloading...
 xorg-xrandr-1.5.1-2-x86_64 downloading...
 libxrandr-1.5.2-3-x86_64 downloading...
 libxrender-0.9.10-4-x86_64 downloading...
 libxcomposite-0.4.5-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libxcomposite...
installing libice...
installing libsm...
installing libxt...
installing libxmu...
installing libxrender...
installing libxrandr...
installing xorg-xrandr...
installing xf86-video-vmware...
installing virtualbox-guest-utils...
:: Running post-transaction hooks...
(1/4) Creating system user accounts...
Creating group 'vboxsf' with GID 109.
(2/4) Reloading system manager configuration...
  Skipped: Running in chroot.
(3/4) Reloading device manager configuration...
  Skipped: Running in chroot.
(4/4) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable vboxservice.service
Created symlink /etc/systemd/system/multi-user.target.wants/vboxservice.service → /usr/lib/systemd/system/vboxservice.service.
++ local USER_GROUPS=vboxsf
++ user_add_groups pai vboxsf
++ local USER=pai
++ local USER_GROUPS=vboxsf
++ '[' false == true ']'
++ arch-chroot /mnt usermod -a -G vboxsf pai
+ '[' '' == true ']'

+ execute_step bootloader
+ local STEP=bootloader
+ eval bootloader
++ bootloader
++ print_step 'bootloader()'
++ STEP='bootloader()'
++ echo ''
++ echo -e '\033[0;96m# bootloader() step\033[0m'
++ echo ''
++ BOOTLOADER_ALLOW_DISCARDS=
++ '[' true '!=' true -a '' '!=' true ']'
++ '[' false == true -o -n '' ']'
++ CMDLINE_LINUX_ROOT=root=UUID=7316564931211648866
++ '[' -n '' ']'
++ '[' zfs == btrfs ']'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' -n '' ']'
[0;96m# bootloader() step[0m

+++ trim_variable ''
+++ local VARIABLE=
++++ echo ''
++++ sed 's/^[[:space:]]*//'
+++ local VARIABLE=
++++ echo ''
++++ sed 's/[[:space:]]*$//'
+++ local VARIABLE=
+++ echo ''
++ CMDLINE_LINUX=
++ case "$BOOTLOADER" in
++ bootloader_grub
++ '[' zfs == zfs ']'
++ ZPOOL_VDEV_NAME_PATH=1
++ export ZPOOL_VDEV_NAME_PATH
++ pacman_install 'grub dosfstools'
++ local ERROR=true
++ set +e
++ PACKAGES=('grub dosfstools')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ execute_sudo 'pacman -Syu --noconfirm --needed grub dosfstools'
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed grub dosfstools'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) dosfstools-4.2-1  grub-2:2.06-4

Total Download Size:    6.87 MiB
Total Installed Size:  34.53 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 grub-2:2.06-4-x86_64 downloading...
 dosfstools-4.2-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing grub...
:: Generate your bootloader configuration with:
     grub-mkconfig -o /boot/grub/grub.cfg
Optional dependencies for grub
    freetype2: For grub-mkfont usage
    fuse2: For grub-mount usage
    dosfstools: For grub-mkrescue FAT FS and EFI support [pending]
    lzop: For grub-mkrescue LZO support
    efibootmgr: For grub-install EFI support
    libisoburn: Provides xorriso for generating grub rescue iso using grub-mkrescue
    os-prober: To detect other OSes when generating grub.cfg in BIOS systems
    mtools: For grub-mkrescue FAT FS support
installing dosfstools...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt sed -i s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/ /etc/default/grub
++ arch-chroot /mnt sed -i 's/#GRUB_SAVEDEFAULT="true"/GRUB_SAVEDEFAULT="true"/' /etc/default/grub
++ arch-chroot /mnt sed -i -E 's/GRUB_CMDLINE_LINUX_DEFAULT="(.*) quiet"/GRUB_CMDLINE_LINUX_DEFAULT="\1"/' /etc/default/grub
++ arch-chroot /mnt sed -i 's/GRUB_CMDLINE_LINUX=""/GRUB_CMDLINE_LINUX=""/' /etc/default/grub
++ echo ''
++ echo '# alis'
++ echo GRUB_DISABLE_SUBMENU=y
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ arch-chroot /mnt grub-install --target=i386-pc --recheck /dev/sda
Installing for i386-pc platform.
Installation finished. No error reported.
++ arch-chroot /mnt grub-mkconfig -o /boot/grub/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-linux
Found initrd image: /boot/initramfs-linux.img
Found fallback initrd image(s) in /boot:  initramfs-linux-fallback.img
Warning: os-prober will not be executed to detect other bootable partitions.
Systems on them will not be added to the GRUB boot configuration.
Check GRUB_DISABLE_OS_PROBER documentation entry.
done
++ '[' true == true ']'
++ echo -n '\EFI\grub\grubx64.efi'
++ arch-chroot /mnt systemctl set-default multi-user.target
Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/multi-user.target.
+ '[' -n bash ']'
+ execute_step custom_shell
+ local STEP=custom_shell

+ eval custom_shell
++ custom_shell
++ print_step 'custom_shell()'
++ STEP='custom_shell()'
++ echo ''
++ echo -e '\033[0;96m# custom_shell() step\033[0m'
++ echo ''
++ local CUSTOM_SHELL_PATH=
++ case "$CUSTOM_SHELL" in
++ '[' -n '' ']'
+ '[' -n '' ']'
+ execute_step packages
+ local STEP=packages
+ eval packages
++ packages
++ print_step 'packages()'
++ STEP='packages()'
++ echo ''
++ echo -e '\033[0;96m# packages() step\033[0m'
++ echo ''
++ '[' false == true ']'
+ '[' false == true ']'
+ '[' false == true ']'
+ execute_step systemd_units
+ local STEP=systemd_units
+ eval systemd_units
++ systemd_units
++ UNITS=()
++ IFS=' '
++ local UNITS
++ date -u '+%F %T'
[0;96m# custom_shell() step[0m


[0;96m# packages() step[0m

+ local 'END_TIMESTAMP=2022-01-28 13:09:28'
+++ date -d '2022-01-28 13:09:28' +%s
+++ date -d '2022-01-28 13:04:42' +%s
++ date -u -d @286 +%T
+ local INSTALLATION_TIME=00:04:46
+ echo -e 'Installation start \033[0;97m2022-01-28 13:04:42\033[0m, end \033[0;97m2022-01-28 13:09:28\033[0m, time \033[0;97m00:04:46\033[0m'
+ execute_step end
+ local STEP=end
+ eval end
++ end
++ echo ''
++ echo -e '\033[0;92mArch Linux installed successfully!\033[0m'
++ echo ''
++ '[' true == true ']'
++ REBOOT=true
++ set +e
++ (( i = 15 ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
Installation start [0;97m2022-01-28 13:04:42[0m, end [0;97m2022-01-28 13:09:28[0m, time [0;97m00:04:46[0m

[0;92mArch Linux installed successfully![0m

++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=0
Rebooting...

++ '[' 0 '!=' 0 ']'
++ '[' r == $'\E' ']'
++ '[' r == r -o r == R ']'
++ REBOOT=true
++ break
++ set -e
++ '[' true == true ']'
++ echo Rebooting...
++ echo ''
++ copy_logs
+++ echo ''
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_LUKS_PASSWORD=
+++ echo changeme
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_ROOT_PASSWORD=changeme
+++ echo changeme
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_USER_PASSWORD=changeme
++ '[' -f alis.conf ']'
++ local SOURCE_FILE=alis.conf
++ local FILE=/mnt/var/log/alis/alis.conf
++ mkdir -p /mnt/var/log/alis
++ cp alis.conf /mnt/var/log/alis/alis.conf
++ chown root:root /mnt/var/log/alis/alis.conf
++ chmod 600 /mnt/var/log/alis/alis.conf
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -f alis.log ']'
++ local SOURCE_FILE=alis.log
++ local FILE=/mnt/var/log/alis/alis.log
++ mkdir -p /mnt/var/log/alis
++ cp alis.log /mnt/var/log/alis/alis.log
++ chown root:root /mnt/var/log/alis/alis.log
++ chmod 600 /mnt/var/log/alis/alis.log
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -f alis.asciinema ']'
++ do_reboot
++ '[' zfs == zfs ']'
++ zfs umount -a
++ zpool export bpool rpool
++ reboot
++ loadkeys de
+ execute_step facts
+ local STEP=facts
+ eval facts
++ facts
++ print_step 'facts()'

++ STEP='facts()'
++ echo ''
++ echo -e '\033[0;96m# facts() step\033[0m'
++ echo ''
++ facts_commons
[0;96m# facts() step[0m

++ '[' -d /sys/firmware/efi ']'
++ BIOS_TYPE=bios
++ '[' -f alis.asciinema -o -f alis-recovery.asciinema ']'
++ ASCIINEMA=false
+++ lscpu
+++ grep GenuineIntel
++ '[' -n '' ']'
+++ lscpu
+++ grep AuthenticAMD
++ '[' -n 'Vendor ID:                       AuthenticAMD' ']'
++ CPU_VENDOR=amd
+++ lspci -nn
+++ grep '\[03'
+++ grep -i intel
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i amd
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i nvidia
++ '[' -n '' ']'
+++ lspci -nn
+++ grep '\[03'
+++ grep -i vmware
++ '[' -n '00:02.0 VGA compatible controller [0300]: VMware SVGA II Adapter [15ad:0405]' ']'
++ GPU_VENDOR=vmware
+++ systemd-detect-virt
+++ grep -i oracle
++ '[' -n oracle ']'
++ VIRTUALBOX=true
+++ systemd-detect-virt
+++ grep -i vmware
++ '[' -n '' ']'
+++ whoami
++ USER_NAME_INSTALL=root
++ '[' root == root ']'
++ SYSTEM_INSTALLATION=true
+++ echo /dev/sda
+++ grep '^/dev/[a-z]d[a-z]'
++ '[' -n /dev/sda ']'
++ DEVICE_SATA=true

++ '[' auto == auto ']'
++ case "$GPU_VENDOR" in
++ case "$AUR_PACKAGE" in
++ AUR_COMMAND=paru
++ '[' auto == auto ']'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ BOOTLOADER=grub
+ execute_step checks
+ local STEP=checks
+ eval checks
++ checks
++ print_step 'checks()'
++ STEP='checks()'
++ echo ''
++ echo -e '\033[0;96m# checks() step\033[0m'
++ echo ''
++ check_facts
++ '[' bios == bios ']'
++ check_variables_list BOOTLOADER grub grub true true
++ local NAME=BOOTLOADER
++ local VALUE=grub
++ local VALUES=grub
++ local REQUIRED=true
++ local SINGLE=true
++ '[' true == '' -o true == true ']'
++ check_variables_value BOOTLOADER grub
++ local NAME=BOOTLOADER
++ local VALUE=grub
++ '[' -z grub ']'
++ [[ true == '' ]]
++ [[ true == \t\r\u\e ]]
++ [[ grub != '' ]]
++ [[ grub =~   ]]
[0;96m# checks() step[0m

+++ echo grub
+++ grep -F -w grub
++ '[' grub '!=' '' -a -z grub ']'
+ execute_step prepare
+ local STEP=prepare
+ eval prepare
++ prepare
++ print_step 'prepare()'
++ STEP='prepare()'
++ echo ''
++ echo -e '\033[0;96m# prepare() step\033[0m'
++ echo ''
++ configure_reflector
++ '[' false == false ']'
++ systemctl stop reflector.service

[0;96m# prepare() step[0m

++ configure_time
++ timedatectl set-ntp true
++ prepare_partition
++ set +e
++ mountpoint -q /mnt/boot
++ '[' 1 == 0 ']'
++ mountpoint -q /mnt
++ '[' 32 == 0 ']'
++ lvs vg-root
  Volume group "vg-root" not found
  Cannot process volume group vg-root
++ '[' 5 == 0 ']'
++ vgs vg
  Volume group "vg" not found
  Cannot process volume group vg
++ '[' 5 == 0 ']'
++ '[' -e /dev/mapper/cryptroot ']'
++ set -e
++ ask_passwords
++ '[' '' == ask ']'
++ '[' -n '' -a ask == ask ']'
++ '[' changeme == ask ']'
++ '[' changeme == ask ']'
++ configure_network
++ '[' -n '' ']'
++ ping -c 1 -i 2 -W 5 -w 30 mirrors.kernel.org
PING mirrors.sfo.kernel.org (149.20.37.36) 56(84) bytes of data.
64 bytes from sfo-korg-mirror.kernel.org (149.20.37.36): icmp_seq=1 ttl=63 time=173 ms

--- mirrors.sfo.kernel.org ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 173.389/173.389/173.389/0.000 ms
++ '[' 0 -ne 0 ']'

[0;96m# partition() step[0m

+ execute_step partition
+ local STEP=partition
+ eval partition
++ partition
++ print_step 'partition()'
++ STEP='partition()'
++ echo ''
++ echo -e '\033[0;96m# partition() step\033[0m'
++ echo ''
++ partprobe -s /dev/sda
/dev/sda: gpt partitions 1 2 3
++ partition_setup
++ '[' auto == auto ']'
++ PARTITION_PARTED_FILE_SYSTEM_TYPE=zfs
++ '[' zfs == f2fs ']'
++ '[' zfs == zfs ']'
++ PARTITION_PARTED_UEFI='#TODO'
++ PARTITION_PARTED_BIOS='mklabel gpt mkpart non-fs 0% 2 mkpart bpool 2 1000 mkpart rpool 1000 100% set 1 bios_grub on set 2 boot on'
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ '[' true == true ']'
++ PARTITION_BOOT=/dev/sda1
++ PARTITION_ROOT=/dev/sda2
++ DEVICE_ROOT=/dev/sda2
++ '[' false == true ']'
++ '[' false == true ']'
++ '[' auto == custom -o auto == manual ']'
++ PARTITION_BOOT_NUMBER=/dev/sda1
++ PARTITION_ROOT_NUMBER=/dev/sda2
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_BOOT_NUMBER=1
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ PARTITION_ROOT_NUMBER=2
++ '[' zfs '!=' zfs ']'
++ '[' zfs == zfs ']'
++ load_zfs
++ curl -s https://eoli3n.github.io/archzfs/init
++ bash

[1m> Testing if archiso is running[0m

[1m> Increasing cowspace to half of RAM[0m

[1m> Adding archzfs repo[0m

[1m> Current kernel version is 5.15.12-arch1-1[0m

[1m> Searching zfs-linux on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Searching zfs-linux on http://archzfs.com/archive_archzfs/...[0m

[1m> Package "zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst" found[0m
/alis

[1m> Downloading to /tmp/zfs-linux-2.1.2_5.15.12.arch1.1-1-x86_64.pkg.tar.zst ...[0m

[1m> Extracting zfs-utils version from zfs-linux PKGINFO[0m

[1m> Searching zfs-utils on http://archzfs.com/archzfs/x86_64/...[0m

[1m> Package "zfs-utils-2.1.2-1-x86_64.pkg.tar.zst" found[0m

[1m> Installing zfs-utils and zfs-linux[0m

[32mZFS is ready

+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda2
++ BOOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
+++ ls -n /dev/disk/by-id/
+++ awk '{print $(NF-2)}'
++++ basename /dev/sda
+++ grep sda3
++ ROOT_PARTITION_ID=ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ echo ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ create_zfs_datasets ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ ZFS_BOOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ ZFS_ROOT_DISK=/dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zpool create -f -o ashift=12 -d -o feature@async_destroy=enabled -o feature@bookmarks=enabled -o feature@embedded_data=enabled -o feature@empty_bpobj=enabled -o feature@enabled_txg=enabled -o feature@extensible_dataset=enabled -o feature@filesystem_limits=enabled -o feature@hole_birth=enabled -o feature@large_blocks=enabled -o feature@lz4_compress=enabled -o feature@spacemap_histogram=enabled -o feature@zpool_checkpoint=enabled -O acltype=posixacl -O canmount=off -O compression=lz4 -O devices=off -O normalization=formD -O relatime=on -O xattr=sa -O mountpoint=/boot -R /mnt bpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2
++ echo changeme
++ zpool create -f -o ashift=12 -O acltype=posixacl -O relatime=on -O xattr=sa -O dnodesize=legacy -O normalization=formD -O mountpoint=none -O canmount=off -O devices=off -R /mnt -O compression=lz4 -O encryption=aes-256-gcm -O keyformat=passphrase -O keylocation=prompt rpool /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3
++ zfs create -o mountpoint=/boot bpool/boot
++ zfs create -o mountpoint=none rpool/data
++ zfs create -o mountpoint=none rpool/ROOT
++ zfs create -o mountpoint=/ -o canmount=noauto rpool/ROOT/default
++ zfs create -o mountpoint=/home rpool/data/home
++ zfs create -o mountpoint=/root rpool/data/home/root
++ zfs create -o mountpoint=/var -o canmount=off rpool/var
++ zfs create rpool/var/log
++ zfs create -o acltype=posixacl rpool/var/logjournal
++ zfs create -o mountpoint=/var/lib -o canmount=off rpool/var/lib
++ zfs create rpool/var/lib/libvirt
++ zfs create rpool/var/lib/docker
++ zpool export bpool
++ zpool export rpool
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part3 -R /mnt rpool -N
++ zpool import -d /dev/disk/by-id/ata-VBOX_HARDDISK_VB85140b9b-0b8428b9-part2 -R /mnt bpool -N
++ echo changeme
++ zfs load-key rpool
++ zfs mount rpool/ROOT/default
++ zfs mount -a
++ zpool set bootfs=rpool/ROOT/default rpool
++ partition_options
++ PARTITION_OPTIONS_BOOT=defaults
++ PARTITION_OPTIONS=defaults
++ '[' true == true ']'
++ PARTITION_OPTIONS_BOOT=defaults,noatime
++ PARTITION_OPTIONS=defaults,noatime
++ '[' zfs == f2fs ']'
++ '[' zfs == btrfs ']'
++ partition_mount
++ '[' zfs == btrfs ']'
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ BOOT_DIRECTORY=/boot
++ ESP_DIRECTORY=/boot
+++ blkid -s UUID -o value /dev/sda1
++ UUID_BOOT=
+++ blkid -s UUID -o value /dev/sda2
++ UUID_ROOT=6225746867178490346
+++ blkid -s PARTUUID -o value /dev/sda1
++ PARTUUID_BOOT=a3caf38a-782c-43e8-9b05-e99d6a2fd018
+++ blkid -s PARTUUID -o value /dev/sda2
++ PARTUUID_ROOT=9c5498f2-e8b7-48b2-8254-bc366ab36abd

[0;96m# install() step[0m

+ execute_step install
+ local STEP=install
+ eval install
++ install
++ print_step 'install()'
++ STEP='install()'
++ echo ''
++ echo -e '\033[0;96m# install() step\033[0m'
++ echo ''
++ '[' -n 'https://mirrors.kernel.org/archlinux/$repo/os/$arch' ']'
++ echo 'Server = https://mirrors.kernel.org/archlinux/$repo/os/$arch'
++ '[' false == true ']'
++ sed -i s/#Color/Color/ /etc/pacman.conf
++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /etc/pacman.conf
++ pacstrap /mnt base base-devel linux linux-firmware
==> Creating install root at /mnt
==> Installing packages to /mnt
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: There are 24 members in group base-devel:
:: Repository core
   1) autoconf  2) automake  3) binutils  4) bison  5) fakeroot  6) file  7) findutils  8) flex  9) gawk  10) gcc  11) gettext  12) grep  13) groff  14) gzip  15) libtool  16) m4  17) make  18) pacman  19) patch  20) pkgconf  21) sed  22) sudo  23) texinfo  24) which

Enter a selection (default=all): 
resolving dependencies...
:: There are 3 providers available for initramfs:
:: Repository core
   1) mkinitcpio
:: Repository extra
   2) booster  3) dracut

Enter a number (default=1): 
looking for conflicting packages...

Packages (139) acl-2.3.1-1  archlinux-keyring-20220125-1  argon2-20190702-4  attr-2.5.1-1  audit-3.0.6-5  bash-5.1.016-1  brotli-1.0.9-7  bzip2-1.0.8-4  ca-certificates-20210603-1  ca-certificates-mozilla-3.74-1  ca-certificates-utils-20210603-1  coreutils-9.0-2  cryptsetup-2.4.3-1  curl-7.81.0-1  db-5.3.28-5  dbus-1.12.20-1  device-mapper-2.03.14-2  diffutils-3.8-1  e2fsprogs-1.46.5-1  elfutils-0.186-2  expat-2.4.3-1  filesystem-2021.12.07-1  gc-8.2.0-2  gcc-libs-11.1.0-3  gdbm-1.22-1  glib2-2.70.3-1  glibc-2.33-5  gmp-6.2.1-1  gnupg-2.2.32-2  gnutls-3.7.3-1  gpgme-1.16.0-3  guile-2.2.7-2  hwdata-0.355-1  iana-etc-20220110-1  icu-70.1-1  iproute2-5.16.0-1  iptables-1:1.8.7-1  iputils-20211215-1  json-c-0.15-2  kbd-2.4.0-2  keyutils-1.6.3-1  kmod-29-1  krb5-1.19.2-2  less-1:590-1  libarchive-3.5.2-2  libassuan-2.5.5-1  libcap-2.63-1  libcap-ng-0.8.2-6  libcroco-0.6.13-2  libelf-0.186-2  libffi-3.4.2-4  libgcrypt-1.9.4-1  libgpg-error-1.43-1  libidn2-2.3.2-1  libksba-1.6.0-1  libldap-2.6.1-1  libmnl-1.0.4-3  libmpc-1.2.1-1  libnetfilter_conntrack-1.0.8-1  libnfnetlink-1.0.1-4  libnftnl-1.2.1-1  libnghttp2-1.46.0-1  libnl-3.5.0-3  libp11-kit-0.24.1-1  libpcap-1.10.1-1  libpsl-0.21.1-1  libsasl-2.1.27-3  libseccomp-2.5.3-3  libsecret-0.20.4-1  libssh2-1.10.0-1  libsysprof-capture-3.42.1-2  libtasn1-4.18.0-1  libtirpc-1.3.2-1  libunistring-0.9.10-3  libxcrypt-4.4.27-1  libxml2-2.9.12-7  licenses-20220125-1  linux-api-headers-5.12.3-1  linux-firmware-whence-20220119.0c6a7b3-2  lz4-1:1.9.3-2  mkinitcpio-31-2  mkinitcpio-busybox-1.34.1-1  mpfr-4.1.0.p13-1  ncurses-6.3-1  nettle-3.7.3-1  npth-1.6-3  openssl-1.1.1.m-1  p11-kit-0.24.1-1  pacman-mirrorlist-20220116-1  pam-1.5.2-1  pambase-20211210-1  pciutils-3.7.0-2  pcre-8.45-1  pcre2-10.39-1  perl-5.34.0-3  pinentry-1.2.0-1  popt-1.18-2  procps-ng-3.3.17-1  psmisc-23.4-1  readline-8.1.001-1  shadow-4.8.1-4  sqlite-3.37.2-1  systemd-250.3-1  systemd-libs-250.3-1  systemd-sysvcompat-250.3-1  tar-1.34-1  tzdata-2021e-1  util-linux-2.37.3-1  util-linux-libs-2.37.3-1  xz-5.2.5-2  zlib-1:1.2.11-5  zstd-1.5.2-1  autoconf-2.71-1  automake-1.16.5-1  base-2-2  binutils-2.36.1-3  bison-3.8.2-1  fakeroot-1.27-1  file-5.41-1  findutils-4.8.0-1  flex-2.6.4-3  gawk-5.1.1-1  gcc-11.1.0-3  gettext-0.21-1  grep-3.7-1  groff-1.22.4-6  gzip-1.11-1  libtool-2.4.6+42+gb88cebd5-16  linux-5.16.2.arch1-1  linux-firmware-20220119.0c6a7b3-2  m4-1.4.19-1  make-4.3-3  pacman-6.0.1-3  patch-2.7.6-8  pkgconf-1.8.0-1  sed-4.8-1  sudo-1.9.8.p2-3  texinfo-6.8-2  which-2.21-5

Total Download Size:    477.67 MiB
Total Installed Size:  1116.91 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-5.16.2.arch1-1-x86_64 downloading...
 linux-firmware-20220119.0c6a7b3-2-any downloading...
 gcc-11.1.0-3-x86_64 downloading...
 gcc-libs-11.1.0-3-x86_64 downloading...
 perl-5.34.0-3-x86_64 downloading...
 icu-70.1-1-x86_64 downloading...
 glibc-2.33-5-x86_64 downloading...
 systemd-250.3-1-x86_64 downloading...
 guile-2.2.7-2-x86_64 downloading...
 binutils-2.36.1-3-x86_64 downloading...
 openssl-1.1.1.m-1-x86_64 downloading...
 glib2-2.70.3-1-x86_64 downloading...
 gnutls-3.7.3-1-x86_64 downloading...
 coreutils-9.0-2-x86_64 downloading...
 gnupg-2.2.32-2-x86_64 downloading...
 util-linux-2.37.3-1-x86_64 downloading...
 groff-1.22.4-6-x86_64 downloading...
 gettext-0.21-1-x86_64 downloading...
 sqlite-3.37.2-1-x86_64 downloading...
 bash-5.1.016-1-x86_64 downloading...
 sudo-1.9.8.p2-3-x86_64 downloading...
 texinfo-6.8-2-x86_64 downloading...
 libxml2-2.9.12-7-x86_64 downloading...
 krb5-1.19.2-2-x86_64 downloading...
 kbd-2.4.0-2-x86_64 downloading...
 e2fsprogs-1.46.5-1-x86_64 downloading...
 shadow-4.8.1-4-x86_64 downloading...
 gawk-5.1.1-1-x86_64 downloading...
 ncurses-6.3-1-x86_64 downloading...
 linux-api-headers-5.12.3-1-any downloading...
 curl-7.81.0-1-x86_64 downloading...
 pcre2-10.39-1-x86_64 downloading...
 db-5.3.28-5-x86_64 downloading...
 iproute2-5.16.0-1-x86_64 downloading...
 archlinux-keyring-20220125-1-any downloading...
 pcre-8.45-1-x86_64 downloading...
 pacman-6.0.1-3-x86_64 downloading...
 tar-1.34-1-x86_64 downloading...
 bison-3.8.2-1-x86_64 downloading...
 zstd-1.5.2-1-x86_64 downloading...
 autoconf-2.71-1-any downloading...
 libunistring-0.9.10-3-x86_64 downloading...
 systemd-libs-250.3-1-x86_64 downloading...
 automake-1.16.5-1-any downloading...
 cryptsetup-2.4.3-1-x86_64 downloading...
 pam-1.5.2-1-x86_64 downloading...
 elfutils-0.186-2-x86_64 downloading...
 libgcrypt-1.9.4-1-x86_64 downloading...
 libelf-0.186-2-x86_64 downloading...
 procps-ng-3.3.17-1-x86_64 downloading...
 libarchive-3.5.2-2-x86_64 downloading...
 findutils-4.8.0-1-x86_64 downloading...
 make-4.3-3-x86_64 downloading...
 hwdata-0.355-1-any downloading...
 libp11-kit-0.24.1-1-x86_64 downloading...
 gpgme-1.16.0-3-x86_64 downloading...
 gmp-6.2.1-1-x86_64 downloading...
 iptables-1:1.8.7-1-x86_64 downloading...
 nettle-3.7.3-1-x86_64 downloading...
 libtool-2.4.6+42+gb88cebd5-16-x86_64 downloading...
 mpfr-4.1.0.p13-1-x86_64 downloading...
 libnl-3.5.0-3-x86_64 downloading...
 tzdata-2021e-1-x86_64 downloading...
 iana-etc-20220110-1-any downloading...
 brotli-1.0.9-7-x86_64 downloading...
 audit-3.0.6-5-x86_64 downloading...
 diffutils-3.8-1-x86_64 downloading...
 file-5.41-1-x86_64 downloading...
 util-linux-libs-2.37.3-1-x86_64 downloading...
 ca-certificates-mozilla-3.74-1-x86_64 downloading...
 readline-8.1.001-1-x86_64 downloading...
 dbus-1.12.20-1-x86_64 downloading...
 xz-5.2.5-2-x86_64 downloading...
 flex-2.6.4-3-x86_64 downloading...
 device-mapper-2.03.14-2-x86_64 downloading...
 libldap-2.6.1-1-x86_64 downloading...
 libpcap-1.10.1-1-x86_64 downloading...
 mkinitcpio-busybox-1.34.1-1-x86_64 downloading...
 gdbm-1.22-1-x86_64 downloading...
 m4-1.4.19-1-x86_64 downloading...
 grep-3.7-1-x86_64 downloading...
 libsecret-0.20.4-1-x86_64 downloading...
 sed-4.8-1-x86_64 downloading...
 libgpg-error-1.43-1-x86_64 downloading...
 gc-8.2.0-2-x86_64 downloading...
 libssh2-1.10.0-1-x86_64 downloading...
 psmisc-23.4-1-x86_64 downloading...
 libtirpc-1.3.2-1-x86_64 downloading...
 libcroco-0.6.13-2-x86_64 downloading...
 libsasl-2.1.27-3-x86_64 downloading...
 p11-kit-0.24.1-1-x86_64 downloading...
 libidn2-2.3.2-1-x86_64 downloading...
 libksba-1.6.0-1-x86_64 downloading...
 acl-2.3.1-1-x86_64 downloading...
 iputils-20211215-1-x86_64 downloading...
 libtasn1-4.18.0-1-x86_64 downloading...
 pinentry-1.2.0-1-x86_64 downloading...
 lz4-1:1.9.3-2-x86_64 downloading...
 expat-2.4.3-1-x86_64 downloading...
 less-1:590-1-x86_64 downloading...
 libassuan-2.5.5-1-x86_64 downloading...
 kmod-29-1-x86_64 downloading...
 keyutils-1.6.3-1-x86_64 downloading...
 pciutils-3.7.0-2-x86_64 downloading...
 libnghttp2-1.46.0-1-x86_64 downloading...
 patch-2.7.6-8-x86_64 downloading...
 zlib-1:1.2.11-5-x86_64 downloading...
 libxcrypt-4.4.27-1-x86_64 downloading...
 libseccomp-2.5.3-3-x86_64 downloading...
 libcap-2.63-1-x86_64 downloading...
 gzip-1.11-1-x86_64 downloading...
 libpsl-0.21.1-1-x86_64 downloading...
 popt-1.18-2-x86_64 downloading...
 libmpc-1.2.1-1-x86_64 downloading...
 fakeroot-1.27-1-x86_64 downloading...
 libnftnl-1.2.1-1-x86_64 downloading...
 licenses-20220125-1-any downloading...
 attr-2.5.1-1-x86_64 downloading...
 pkgconf-1.8.0-1-x86_64 downloading...
 bzip2-1.0.8-4-x86_64 downloading...
 json-c-0.15-2-x86_64 downloading...
 libnetfilter_conntrack-1.0.8-1-x86_64 downloading...
 libsysprof-capture-3.42.1-2-x86_64 downloading...
 libffi-3.4.2-4-x86_64 downloading...
 mkinitcpio-31-2-any downloading...
 libcap-ng-0.8.2-6-x86_64 downloading...
 argon2-20190702-4-x86_64 downloading...
 linux-firmware-whence-20220119.0c6a7b3-2-any downloading...
 npth-1.6-3-x86_64 downloading...
 libnfnetlink-1.0.1-4-x86_64 downloading...
 which-2.21-5-x86_64 downloading...
 filesystem-2021.12.07-1-x86_64 downloading...
 libmnl-1.0.4-3-x86_64 downloading...
 ca-certificates-utils-20210603-1-any downloading...
 pacman-mirrorlist-20220116-1-any downloading...
 systemd-sysvcompat-250.3-1-x86_64 downloading...
 pambase-20211210-1-any downloading...
 base-2-2-any downloading...
 ca-certificates-20210603-1-any downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing iana-etc...
installing filesystem...
warning: directory permissions differ on /mnt/root/
filesystem: 755  package: 750
installing linux-api-headers...
installing tzdata...
installing glibc...
Optional dependencies for glibc
    gd: for memusagestat
installing gcc-libs...
installing ncurses...
Optional dependencies for ncurses
    bash: for ncursesw6-config [pending]
installing readline...
installing bash...
Optional dependencies for bash
    bash-completion: for tab completion
installing attr...
installing acl...
installing gmp...
installing util-linux-libs...
installing e2fsprogs...
installing openssl...
Optional dependencies for openssl
    ca-certificates [pending]
    perl [pending]
installing libsasl...
installing libldap...
installing keyutils...
installing krb5...
installing libtirpc...
installing pambase...
installing libcap-ng...
installing audit...
installing libxcrypt...
installing pam...
installing libcap...
installing coreutils...
installing zlib...
installing xz...
installing bzip2...
installing libseccomp...
installing file...
installing findutils...
installing mpfr...
installing gawk...
installing pcre...
installing grep...
installing libgpg-error...
installing libgcrypt...
installing libtasn1...
installing libffi...
installing libp11-kit...
installing lz4...
installing zstd...
installing systemd-libs...
installing procps-ng...
installing sed...
installing tar...
installing libsysprof-capture...
installing glib2...
Optional dependencies for glib2
    python: gdbus-codegen, glib-genmarshal, glib-mkenums, gtester-report
    libelf: gresource inspection tool [pending]
installing libunistring...
installing icu...
installing libxml2...
installing libcroco...
installing gettext...
Optional dependencies for gettext
    git: for autopoint infrastructure updates
installing hwdata...
installing kmod...
installing pciutils...
installing psmisc...
installing shadow...
installing util-linux...
Optional dependencies for util-linux
    python: python bindings to libmount
    words: default dictionary for look
installing pcre2...
installing less...
installing gzip...
installing licenses...
installing expat...
installing libarchive...
installing p11-kit...
installing ca-certificates-utils...
installing ca-certificates-mozilla...
installing ca-certificates...
installing brotli...
installing libidn2...
installing libnghttp2...
installing libpsl...
installing libssh2...
installing curl...
installing npth...
installing libksba...
installing libassuan...
installing libsecret...
Optional dependencies for libsecret
    org.freedesktop.secrets: secret storage backend
installing pinentry...
Optional dependencies for pinentry
    gtk2: gtk2 backend
    qt5-base: qt backend
    gcr: gnome3 backend
installing nettle...
installing gnutls...
Optional dependencies for gnutls
    guile: for use with Guile bindings [pending]
installing sqlite...
installing gnupg...
Optional dependencies for gnupg
    libldap: gpg2keys_ldap [installed]
    libusb-compat: scdaemon
    pcsclite: scdaemon
installing gpgme...
installing pacman-mirrorlist...
installing archlinux-keyring...
installing pacman...
Optional dependencies for pacman
    perl-locale-gettext: translation support in makepkg-template
installing device-mapper...
installing popt...
installing json-c...
installing argon2...
installing cryptsetup...
installing dbus...
installing libmnl...
installing libnftnl...
installing libnl...
installing libpcap...
installing libnfnetlink...
installing libnetfilter_conntrack...
installing iptables...
installing kbd...
installing libelf...
installing systemd...
Initializing machine ID from random generator.
Creating group 'sys' with GID 3.
Creating group 'mem' with GID 8.
Creating group 'ftp' with GID 11.
Creating group 'mail' with GID 12.
Creating group 'log' with GID 19.
Creating group 'smmsp' with GID 25.
Creating group 'proc' with GID 26.
Creating group 'games' with GID 50.
Creating group 'lock' with GID 54.
Creating group 'network' with GID 90.
Creating group 'floppy' with GID 94.
Creating group 'scanner' with GID 96.
Creating group 'power' with GID 98.
Creating group 'nobody' with GID 65534.
Creating group 'adm' with GID 999.
Creating group 'wheel' with GID 998.
Creating group 'utmp' with GID 997.
Creating group 'audio' with GID 996.
Creating group 'disk' with GID 995.
Creating group 'input' with GID 994.
Creating group 'kmem' with GID 993.
Creating group 'kvm' with GID 992.
Creating group 'lp' with GID 991.
Creating group 'optical' with GID 990.
Creating group 'render' with GID 989.
Creating group 'sgx' with GID 988.
Creating group 'storage' with GID 987.
Creating group 'tty' with GID 5.
Creating group 'uucp' with GID 986.
Creating group 'video' with GID 985.
Creating group 'users' with GID 984.
Creating group 'systemd-journal' with GID 983.
Creating group 'rfkill' with GID 982.
Creating group 'bin' with GID 1.
Creating user 'bin' (n/a) with UID 1 and GID 1.
Creating group 'daemon' with GID 2.
Creating user 'daemon' (n/a) with UID 2 and GID 2.
Creating user 'mail' (n/a) with UID 8 and GID 12.
Creating user 'ftp' (n/a) with UID 14 and GID 11.
Creating group 'http' with GID 33.
Creating user 'http' (n/a) with UID 33 and GID 33.
Creating user 'nobody' (Nobody) with UID 65534 and GID 65534.
Creating group 'dbus' with GID 81.
Creating user 'dbus' (System Message Bus) with UID 81 and GID 81.
Creating group 'systemd-coredump' with GID 981.
Creating user 'systemd-coredump' (systemd Core Dumper) with UID 981 and GID 981.
Creating group 'systemd-network' with GID 980.
Creating user 'systemd-network' (systemd Network Management) with UID 980 and GID 980.
Creating group 'systemd-oom' with GID 979.
Creating user 'systemd-oom' (systemd Userspace OOM Killer) with UID 979 and GID 979.
Creating group 'systemd-journal-remote' with GID 978.
Creating user 'systemd-journal-remote' (systemd Journal Remote) with UID 978 and GID 978.
Creating group 'systemd-resolve' with GID 977.
Creating user 'systemd-resolve' (systemd Resolver) with UID 977 and GID 977.
Creating group 'systemd-timesync' with GID 976.
Creating user 'systemd-timesync' (systemd Time Synchronization) with UID 976 and GID 976.
Creating group 'uuidd' with GID 68.
Creating user 'uuidd' (n/a) with UID 68 and GID 68.
Created symlink /etc/systemd/system/getty.target.wants/getty@tty1.service → /usr/lib/systemd/system/getty@.service.
Created symlink /etc/systemd/system/multi-user.target.wants/remote-fs.target → /usr/lib/systemd/system/remote-fs.target.
:: Append 'init=/usr/lib/systemd/systemd' to your kernel command line in your
   bootloader to replace sysvinit with systemd, or install systemd-sysvcompat
Optional dependencies for systemd
    libmicrohttpd: remote journald capabilities
    quota-tools: kernel-level quota management
    systemd-sysvcompat: symlink package to provide sysvinit binaries [pending]
    polkit: allow administration as unprivileged user
    curl: machinectl pull-tar and pull-raw [installed]
    libfido2: unlocking LUKS2 volumes with FIDO2 token
    tpm2-tss: unlocking LUKS2 volumes with TPM2
installing systemd-sysvcompat...
installing iputils...
installing iproute2...
Optional dependencies for iproute2
    db: userspace arp daemon [pending]
    libcap: tipc [installed]
    linux-atm: ATM support
installing base...
Optional dependencies for base
    linux: bare metal support [pending]
installing m4...
installing diffutils...
installing gdbm...
installing db...
installing perl...
installing autoconf...
installing automake...
installing elfutils...
installing binutils...
installing bison...
installing fakeroot...
installing flex...
installing libmpc...
installing gcc...
Optional dependencies for gcc
    lib32-gcc-libs: for generating code for 32-bit ABI
installing groff...
Optional dependencies for groff
    netpbm: for use together with man -H command interaction in browsers
    psutils: for use together with man -H command interaction in browsers
    libxaw: for gxditview
    perl-file-homedir: for use with glilypond
installing libtool...
installing texinfo...
installing gc...
installing guile...
installing make...
installing patch...
Optional dependencies for patch
    ed: for patch -e functionality
installing pkgconf...
installing sudo...
installing which...
installing mkinitcpio-busybox...
installing mkinitcpio...
Optional dependencies for mkinitcpio
    gzip: Use gzip compression for the initramfs image [installed]
    xz: Use lzma or xz compression for the initramfs image [installed]
    bzip2: Use bzip2 compression for the initramfs image [installed]
    lzop: Use lzo compression for the initramfs image
    lz4: Use lz4 compression for the initramfs image [installed]
    mkinitcpio-nfs-utils: Support for root filesystem on NFS
installing linux...
Optional dependencies for linux
    crda: to set the correct wireless channels of your country
    linux-firmware: firmware images needed for some devices [pending]
installing linux-firmware-whence...
installing linux-firmware...
:: Running post-transaction hooks...
( 1/14) Creating system user accounts...
( 2/14) Updating journal message catalog...
( 3/14) Reloading system manager configuration...
  Skipped: Running in chroot.
( 4/14) Updating udev hardware database...
( 5/14) Applying kernel sysctl settings...
  Skipped: Running in chroot.
( 6/14) Creating temporary files...
( 7/14) Reloading device manager configuration...
  Skipped: Running in chroot.
( 8/14) Arming ConditionNeedsUpdate...
( 9/14) Rebuilding certificate stores...
(10/14) Updating module dependencies...
(11/14) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> ERROR: file not found: `fsck.zfs'
==> WARNING: No fsck helpers found. fsck will not be run on boot.
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> WARNING: errors were encountered during the build. The image may not be complete.
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
error: command failed to execute correctly
(12/14) Reloading system bus configuration...
  Skipped: Running in chroot.
(13/14) Warn about old perl modules
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_MESSAGES = "",
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
(14/14) Updating the info directory file...
++ '[' zfs == zfs ']'
++ cat
++ sed -i s/#Color/Color/ /mnt/etc/pacman.conf
++ '[' true == true ']'
++ sed -i s/#ParallelDownloads/ParallelDownloads/ /mnt/etc/pacman.conf
++ '[' false == true ']'
+ execute_step configure_zfs
+ local STEP=configure_zfs
+ eval configure_zfs
++ configure_zfs
++ pacman_install zfs-linux
++ local ERROR=true
++ set +e
++ PACKAGES=('zfs-linux')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ execute_sudo 'pacman -Syu --noconfirm --needed zfs-linux'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zfs-linux'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zfs-linux'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) zfs-utils-2.1.2-1  zfs-linux-2.1.2_5.16.2.arch1.1-1

Total Download Size:   48.77 MiB
Total Installed Size:  60.28 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 zfs-utils-2.1.2-1-x86_64 downloading...
 zfs-linux-2.1.2_5.16.2.arch1.1-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing zfs-utils...
Optional dependencies for zfs-utils
    python: pyzfs and extra utilities,
    python-cffi: pyzfs
installing zfs-linux...
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Updating module dependencies...
(5/5) Updating linux initcpios...
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache rpool
++ arch-chroot /mnt zpool set cachefile=/etc/zfs/zpool.cache bpool
++ arch-chroot /mnt systemctl enable zfs-import-cache zfs-import.target zfs-mount zfs-zed zfs.target
Created symlink /etc/systemd/system/zfs-import.target.wants/zfs-import-cache.service → /usr/lib/systemd/system/zfs-import-cache.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-import.target → /usr/lib/systemd/system/zfs-import.target.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-mount.service → /usr/lib/systemd/system/zfs-mount.service.
Created symlink /etc/systemd/system/zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/zfs.target.wants/zfs-zed.service → /usr/lib/systemd/system/zfs-zed.service.
Created symlink /etc/systemd/system/multi-user.target.wants/zfs.target → /usr/lib/systemd/system/zfs.target.

[0;96m# configuration() step[0m

+ execute_step configuration
+ local STEP=configuration
+ eval configuration
++ configuration
++ print_step 'configuration()'
++ STEP='configuration()'
++ echo ''
++ echo -e '\033[0;96m# configuration() step\033[0m'
++ echo ''
++ '[' zfs '!=' zfs ']'
++ '[' -n '' ']'
++ '[' true == true ']'
++ '[' zfs == f2fs ']'
++ sed -i s/relatime/noatime/ /mnt/etc/fstab
++ arch-chroot /mnt systemctl enable fstrim.timer
Created symlink /etc/systemd/system/timers.target.wants/fstrim.timer → /usr/lib/systemd/system/fstrim.timer.
++ arch-chroot /mnt ln -s -f /usr/share/zoneinfo/Europe/Berlin /etc/localtime
++ arch-chroot /mnt hwclock --systohc
++ for LOCALE in "${LOCALES[@]}"
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen
++ sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /mnt/etc/locale.gen
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANG=en_US.UTF-8
++ for VARIABLE in "${LOCALE_CONF[@]}"
++ echo -e LANGUAGE=en_US:en
++ locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ arch-chroot /mnt locale-gen
Generating locales...
  en_US.UTF-8... done
Generation complete.
++ echo -e 'KEYMAP=en\n\n'
++ echo archlinux
++ local OPTIONS=
++ '[' -n en ']'
++ local 'OPTIONS=
    Option "XkbLayout" "en"'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ '[' -n '' ']'
++ arch-chroot /mnt mkdir -p /etc/X11/xorg.conf.d/
++ cat
++ '[' -n '' ']'
++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd
New password: Retype new password: passwd: password updated successfully
+ execute_step mkinitcpio_configuration
+ local STEP=mkinitcpio_configuration

[0;96m# mkinitcpio_configuration() step[0m

+ eval mkinitcpio_configuration
++ mkinitcpio_configuration
++ print_step 'mkinitcpio_configuration()'
++ STEP='mkinitcpio_configuration()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio_configuration() step\033[0m'
++ echo ''
++ '[' true == true ']'
++ local MKINITCPIO_KMS_MODULES=
++ case "$DISPLAY_DRIVER" in
++ local 'MODULES=!vmd '
++ '[' auto == intel ']'
++ '[' false == true ']'
++ '[' zfs == btrfs ']'
++ '[' zfs == xfs ']'
++ '[' zfs == f2fs ']'
++ '[' zfs == reiserfs ']'
++ '[' false == true ']'
++ '[' grub == systemd ']'
+++ sed 's/!udev/udev/'
+++ echo 'base !udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++ HOOKS='base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev !usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!usr/usr/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard !keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!keymap/keymap/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap !consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ sed 's/!consolefont/consolefont/'
++ HOOKS='base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++ '[' -n '' ']'
+++ sanitize_variable 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ local 'VARIABLE=base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
++++ sed 's/![^ ]*//g'
++++ echo 'base udev usr !resume !systemd !btrfs autodetect keyboard keymap consolefont !sd-vconsole modconf block !net !dmraid !mdadm !mdadm_udev !encrypt !sd-encrypt !lvm2 !fsck zfs filesystems'
+++ local 'VARIABLE=base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ echo 'base udev usr    autodetect keyboard keymap consolefont  modconf block         zfs filesystems'
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/^[[:space:]]*//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++++ sed 's/[[:space:]]*$//'
+++ local 'VARIABLE=base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ echo 'base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
++ HOOKS='base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems'
+++ sanitize_variable '!vmd '
+++ local 'VARIABLE=!vmd '
++++ echo '!vmd '
++++ sed 's/![^ ]*//g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed -r 's/ {2,}/ /g'
+++ local 'VARIABLE= '
++++ echo ' '
++++ sed 's/^[[:space:]]*//'
+++ local VARIABLE=
++++ echo ''
++++ sed 's/[[:space:]]*$//'
+++ local VARIABLE=
+++ echo ''
++ MODULES=
++ arch-chroot /mnt sed -i 's/^HOOKS=(.*)$/HOOKS=(base udev usr autodetect keyboard keymap consolefont modconf block zfs filesystems)/' /etc/mkinitcpio.conf
++ arch-chroot /mnt sed -i 's/^MODULES=(.*)/MODULES=()/' /etc/mkinitcpio.conf
++ '[' zstd '!=' '' ']'
++ arch-chroot /mnt sed -i 's/^#COMPRESSION="zstd"/COMPRESSION="zstd"/' /etc/mkinitcpio.conf
++ '[' zstd == bzip2 ']'
++ '[' zstd == lzma -o zstd == xz ']'
++ '[' zstd == lzop ']'
++ '[' zstd == lz4 ']'
++ '[' zstd == zstd ']'
++ pacman_install zstd
++ local ERROR=true
++ set +e
++ PACKAGES=('zstd')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ execute_sudo 'pacman -Syu --noconfirm --needed zstd'
++ local 'COMMAND=pacman -Syu --noconfirm --needed zstd'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed zstd'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
warning: zstd-1.5.2-1 is up to date -- skipping
:: Starting full system upgrade...
 there is nothing to do
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
+ execute_step users
+ local STEP=users
+ eval users
++ users
++ print_step 'users()'
++ STEP='users()'
++ echo ''
++ echo -e '\033[0;96m# users() step\033[0m'
++ echo ''
++ local USERS_GROUPS=wheel,storage,optical
++ create_user pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USERS_GROUPS=wheel,storage,optical
++ '[' false == true ']'
++ create_user_useradd pai changeme wheel,storage,optical
++ local USER=pai
++ local PASSWORD=changeme
++ local USER_GROUPS=wheel,storage,optical
++ arch-chroot /mnt useradd -m -G wheel,storage,optical -s /bin/bash pai

[0;96m# users() step[0m

++ printf 'changeme\nchangeme'
++ arch-chroot /mnt passwd pai
New password: Retype new password: passwd: password updated successfully
++ arch-chroot /mnt sed -i 's/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/' /etc/sudoers
++ pacman_install xdg-user-dirs
++ local ERROR=true
++ set +e
++ PACKAGES=('xdg-user-dirs')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ execute_sudo 'pacman -Syu --noconfirm --needed xdg-user-dirs'
++ local 'COMMAND=pacman -Syu --noconfirm --needed xdg-user-dirs'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed xdg-user-dirs'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (1) xdg-user-dirs-0.17-3

Total Download Size:   0.04 MiB
Total Installed Size:  0.15 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 xdg-user-dirs-0.17-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing xdg-user-dirs...
Created symlink /etc/systemd/user/default.target.wants/xdg-user-dirs-update.service → /usr/lib/systemd/user/xdg-user-dirs-update.service.
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e

[0;96m# display_driver() step[0m

++ '[' false == true ']'
++ '[' false == true ']'
+ '[' -n auto ']'
+ execute_step display_driver
+ local STEP=display_driver
+ eval display_driver
++ display_driver
++ print_step 'display_driver()'
++ STEP='display_driver()'
++ echo ''
++ echo -e '\033[0;96m# display_driver() step\033[0m'
++ echo ''
++ local PACKAGES_DRIVER_PACMAN=true
++ local PACKAGES_DRIVER=
++ local PACKAGES_DRIVER_MULTILIB=
++ local PACKAGES_DDX=
++ local PACKAGES_VULKAN=
++ local PACKAGES_VULKAN_MULTILIB=
++ local PACKAGES_HARDWARE_ACCELERATION=
++ local PACKAGES_HARDWARE_ACCELERATION_MULTILIB=
++ case "$DISPLAY_DRIVER" in
++ '[' false == true ']'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' true == true ']'
++ pacman_install 'mesa    '
++ local ERROR=true
++ set +e
++ PACKAGES=('mesa    ')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ execute_sudo 'pacman -Syu --noconfirm --needed mesa    '
++ local 'COMMAND=pacman -Syu --noconfirm --needed mesa    '
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed mesa    '
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...
warning: dependency cycle detected:
warning: libglvnd will be installed before its mesa dependency

Packages (22) libdrm-2.4.109-1  libedit-20210910_3.1-1  libglvnd-1.4.0-1  libomxil-bellagio-0.9.3-3  libpciaccess-0.16-2  libunwind-1.6.2-1  libx11-1.7.3.1-1  libxau-1.0.9-3  libxcb-1.14-1  libxdamage-1.1.5-3  libxdmcp-1.1.3-3  libxext-1.3.4-3  libxfixes-6.0.0-1  libxshmfence-1.3-2  libxxf86vm-1.1.4-4  llvm-libs-13.0.0-6  lm_sensors-1:3.6.0.r41.g31d1f125-1  vulkan-icd-loader-1.2.203-1  wayland-1.20.0-1  xcb-proto-1.14.1-5  xorgproto-2021.5-1  mesa-21.3.5-1

Total Download Size:    47.23 MiB
Total Installed Size:  225.80 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 llvm-libs-13.0.0-6-x86_64 downloading...
 mesa-21.3.5-1-x86_64 downloading...
 libx11-1.7.3.1-1-x86_64 downloading...
 libxcb-1.14-1-x86_64 downloading...
 libglvnd-1.4.0-1-x86_64 downloading...
 libdrm-2.4.109-1-x86_64 downloading...
 xorgproto-2021.5-1-any downloading...
 lm_sensors-1:3.6.0.r41.g31d1f125-1-x86_64 downloading...
 wayland-1.20.0-1-x86_64 downloading...
 libomxil-bellagio-0.9.3-3-x86_64 downloading...
 vulkan-icd-loader-1.2.203-1-x86_64 downloading...
 libunwind-1.6.2-1-x86_64 downloading...
 libedit-20210910_3.1-1-x86_64 downloading...
 xcb-proto-1.14.1-5-any downloading...
 libxext-1.3.4-3-x86_64 downloading...
 libxdmcp-1.1.3-3-x86_64 downloading...
 libpciaccess-0.16-2-x86_64 downloading...
 libxxf86vm-1.1.4-4-x86_64 downloading...
 libxfixes-6.0.0-1-x86_64 downloading...
 libxau-1.0.9-3-x86_64 downloading...
 libxdamage-1.1.5-3-x86_64 downloading...
 libxshmfence-1.3-2-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libpciaccess...
installing libdrm...
installing wayland...
installing xcb-proto...
installing libxdmcp...
installing libxau...
installing libxcb...
installing xorgproto...
installing libx11...
installing libxext...
installing libxxf86vm...
installing libxfixes...
installing libxdamage...
installing libxshmfence...
installing libomxil-bellagio...
installing libunwind...
installing libedit...
installing llvm-libs...
installing lm_sensors...
Optional dependencies for lm_sensors
    rrdtool: for logging with sensord
    perl: for sensor detection and configuration convert [installed]
installing libglvnd...
installing vulkan-icd-loader...
Optional dependencies for vulkan-icd-loader
    vulkan-driver: packaged vulkan driver
installing mesa...
Optional dependencies for mesa
    opengl-man-pages: for the OpenGL API man pages
    mesa-vdpau: for accelerated video playback
    libva-mesa-driver: for accelerated video playback
:: Running post-transaction hooks...
(1/2) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/2) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e

[0;96m# kernels() step[0m

++ '[' false == true ']'
++ '[' false == true ']'
+ execute_step kernels
+ local STEP=kernels
+ eval kernels
++ kernels
++ print_step 'kernels()'
++ STEP='kernels()'
++ echo ''
++ echo -e '\033[0;96m# kernels() step\033[0m'
++ echo ''
++ pacman_install linux-headers
++ local ERROR=true
++ set +e
++ PACKAGES=('linux-headers')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ execute_sudo 'pacman -Syu --noconfirm --needed linux-headers'
++ local 'COMMAND=pacman -Syu --noconfirm --needed linux-headers'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed linux-headers'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (4) libnsl-2.0.0-1  pahole-1.23-1  python-3.10.2-1  linux-headers-5.16.2.arch1-1

Total Download Size:    37.43 MiB
Total Installed Size:  194.23 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 linux-headers-5.16.2.arch1-1-x86_64 downloading...
 python-3.10.2-1-x86_64 downloading...
 pahole-1.23-1-x86_64 downloading...
 libnsl-2.0.0-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libnsl...
installing python...
Optional dependencies for python
    python-setuptools
    python-pip
    sqlite [installed]
    mpdecimal: for decimal
    xz: for lzma [installed]
    tk: for tkinter
installing pahole...
installing linux-headers...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating module dependencies...
++ '[' 0 == 0 ']'
++ local ERROR=false

[0;96m# mkinitcpio() step[0m

++ break
++ set -e
++ '[' false == true ']'
++ '[' -n '' ']'
+ execute_step mkinitcpio
+ local STEP=mkinitcpio
+ eval mkinitcpio
++ mkinitcpio
++ print_step 'mkinitcpio()'
++ STEP='mkinitcpio()'
++ echo ''
++ echo -e '\033[0;96m# mkinitcpio() step\033[0m'
++ echo ''
++ arch-chroot /mnt mkinitcpio -P
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [autodetect]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux.img
==> Image generation successful
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 5.16.2-arch1-1
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [usr]
  -> Running build hook: [keyboard]
==> WARNING: Possibly missing firmware for module: xhci_pci
  -> Running build hook: [keymap]
loadkeys: Unable to open file: en: No such file or directory
  -> Running build hook: [consolefont]
==> WARNING: consolefont: no font found in configuration
  -> Running build hook: [modconf]
  -> Running build hook: [block]
==> WARNING: Possibly missing firmware for module: qed
==> WARNING: Possibly missing firmware for module: qla1280
==> WARNING: Possibly missing firmware for module: qla2xxx
==> WARNING: Possibly missing firmware for module: aic94xx
==> WARNING: Possibly missing firmware for module: bfa
==> WARNING: Possibly missing firmware for module: wd719x
  -> Running build hook: [zfs]
  -> Running build hook: [filesystems]
==> Generating module dependencies
==> Creating zstd-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> Image generation successful
+ execute_step network
+ local STEP=network
+ eval network
++ network

[0;96m# network() step[0m

++ print_step 'network()'
++ STEP='network()'
++ echo ''
++ echo -e '\033[0;96m# network() step\033[0m'
++ echo ''
++ pacman_install networkmanager
++ local ERROR=true
++ set +e
++ PACKAGES=('networkmanager')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'
++ execute_sudo 'pacman -Syu --noconfirm --needed networkmanager'
++ local 'COMMAND=pacman -Syu --noconfirm --needed networkmanager'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed networkmanager'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (18) bluez-libs-5.63-1  gpm-1.20.7.r38.ge82d1a6-4  jansson-2.14-1  libdaemon-0.14-5  libmm-glib-1.18.4-1  libndp-1.8-1  libnewt-0.52.21-8  libnm-1.34.0-1  libpgm-5.3.128-1  libsodium-1.0.18-2  libteam-1.31-5  mobile-broadband-provider-info-20210805-1  nspr-4.33-1  nss-3.74-1  slang-2.3.2-2  wpa_supplicant-2:2.10-1  zeromq-4.3.4-2  networkmanager-1.34.0-1

Total Download Size:   10.98 MiB
Total Installed Size:  60.62 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 networkmanager-1.34.0-1-x86_64 downloading...
 nss-3.74-1-x86_64 downloading...
 wpa_supplicant-2:2.10-1-x86_64 downloading...
 libnm-1.34.0-1-x86_64 downloading...
 slang-2.3.2-2-x86_64 downloading...
 libmm-glib-1.18.4-1-x86_64 downloading...
 zeromq-4.3.4-2-x86_64 downloading...
 libteam-1.31-5-x86_64 downloading...
 nspr-4.33-1-x86_64 downloading...
 libpgm-5.3.128-1-x86_64 downloading...
 libsodium-1.0.18-2-x86_64 downloading...
 gpm-1.20.7.r38.ge82d1a6-4-x86_64 downloading...
 libnewt-0.52.21-8-x86_64 downloading...
 bluez-libs-5.63-1-x86_64 downloading...
 mobile-broadband-provider-info-20210805-1-any downloading...
 jansson-2.14-1-x86_64 downloading...
 libndp-1.8-1-x86_64 downloading...
 libdaemon-0.14-5-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing nspr...
installing nss...
installing jansson...
installing libnm...
installing wpa_supplicant...
installing libmm-glib...
installing gpm...
installing slang...
installing libnewt...
Optional dependencies for libnewt
    python: libnewt support with the _snack module [installed]
    tcl: whiptcl support
installing libndp...
installing libdaemon...
installing libsodium...
installing libpgm...
installing zeromq...
installing libteam...
installing bluez-libs...
installing mobile-broadband-provider-info...
installing networkmanager...
Optional dependencies for networkmanager
    polkit: let non-root users control networking
    dnsmasq: connection sharing
    nftables: connection sharing
    iptables: connection sharing [installed]
    bluez: Bluetooth support
    ppp: dialup connection support
    modemmanager: cellular network support
    iwd: wpa_supplicant alternative
    dhclient: alternative DHCP client
    dhcpcd: alternative DHCP client
    openresolv: alternative resolv.conf manager
    firewalld: firewall support
:: Running post-transaction hooks...
(1/5) Reloading system manager configuration...
  Skipped: Running in chroot.
(2/5) Reloading device manager configuration...
  Skipped: Running in chroot.
(3/5) Arming ConditionNeedsUpdate...
(4/5) Reloading system bus configuration...
  Skipped: Running in chroot.
(5/5) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable NetworkManager.service
Created symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service → /usr/lib/systemd/system/NetworkManager.service.
Created symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service → /usr/lib/systemd/system/NetworkManager-dispatcher.service.
Created symlink /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service → /usr/lib/systemd/system/NetworkManager-wait-online.service.
+ '[' true == true ']'
+ execute_step virtualbox
+ local STEP=virtualbox

[0;96m# virtualbox() step[0m

+ eval virtualbox
++ virtualbox
++ print_step 'virtualbox()'
++ STEP='virtualbox()'
++ echo ''
++ echo -e '\033[0;96m# virtualbox() step\033[0m'
++ echo ''
++ pacman_install virtualbox-guest-utils
++ local ERROR=true
++ set +e
++ PACKAGES=('virtualbox-guest-utils')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ execute_sudo 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ local 'COMMAND=pacman -Syu --noconfirm --needed virtualbox-guest-utils'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed virtualbox-guest-utils'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (10) libice-1.0.10-3  libsm-1.2.3-2  libxcomposite-0.4.5-3  libxmu-1.1.3-2  libxrandr-1.5.2-3  libxrender-0.9.10-4  libxt-1.2.1-1  xf86-video-vmware-13.3.0-3  xorg-xrandr-1.5.1-2  virtualbox-guest-utils-6.1.32-1

Total Download Size:    2.13 MiB
Total Installed Size:  12.55 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 virtualbox-guest-utils-6.1.32-1-x86_64 downloading...
 libxt-1.2.1-1-x86_64 downloading...
 libice-1.0.10-3-x86_64 downloading...
 xf86-video-vmware-13.3.0-3-x86_64 downloading...
 libxmu-1.1.3-2-x86_64 downloading...
 libsm-1.2.3-2-x86_64 downloading...
 xorg-xrandr-1.5.1-2-x86_64 downloading...
 libxrandr-1.5.2-3-x86_64 downloading...
 libxrender-0.9.10-4-x86_64 downloading...
 libxcomposite-0.4.5-3-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing libxcomposite...
installing libice...
installing libsm...
installing libxt...
installing libxmu...
installing libxrender...
installing libxrandr...
installing xorg-xrandr...
installing xf86-video-vmware...
installing virtualbox-guest-utils...
:: Running post-transaction hooks...
(1/4) Creating system user accounts...
Creating group 'vboxsf' with GID 109.
(2/4) Reloading system manager configuration...
  Skipped: Running in chroot.
(3/4) Reloading device manager configuration...
  Skipped: Running in chroot.
(4/4) Arming ConditionNeedsUpdate...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt systemctl enable vboxservice.service
Created symlink /etc/systemd/system/multi-user.target.wants/vboxservice.service → /usr/lib/systemd/system/vboxservice.service.
++ local USER_GROUPS=vboxsf
++ user_add_groups pai vboxsf
++ local USER=pai
++ local USER_GROUPS=vboxsf
++ '[' false == true ']'
++ arch-chroot /mnt usermod -a -G vboxsf pai
+ '[' '' == true ']'
+ execute_step bootloader

[0;96m# bootloader() step[0m

+ local STEP=bootloader
+ eval bootloader
++ bootloader
++ print_step 'bootloader()'
++ STEP='bootloader()'
++ echo ''
++ echo -e '\033[0;96m# bootloader() step\033[0m'
++ echo ''
++ BOOTLOADER_ALLOW_DISCARDS=
++ '[' true '!=' true -a '' '!=' true ']'
++ '[' false == true -o -n '' ']'
++ CMDLINE_LINUX_ROOT=root=UUID=6225746867178490346
++ '[' -n '' ']'
++ '[' zfs == btrfs ']'
++ '[' zfs == zfs ']'
++ CMDLINE_LINUX=' root=ZFS=rpool\/ROOT\/default'
++ '[' true == true ']'
++ case "$DISPLAY_DRIVER" in
++ '[' -n '' ']'
+++ trim_variable ' root=ZFS=rpool\/ROOT\/default'
+++ local 'VARIABLE= root=ZFS=rpool\/ROOT\/default'
++++ echo ' root=ZFS=rpool\/ROOT\/default'
++++ sed 's/^[[:space:]]*//'
+++ local 'VARIABLE=root=ZFS=rpool\/ROOT\/default'
++++ echo 'root=ZFS=rpool\/ROOT\/default'
++++ sed 's/[[:space:]]*$//'
+++ local 'VARIABLE=root=ZFS=rpool\/ROOT\/default'
+++ echo 'root=ZFS=rpool\/ROOT\/default'
++ CMDLINE_LINUX='root=ZFS=rpool\/ROOT\/default'
++ case "$BOOTLOADER" in
++ bootloader_grub
++ '[' zfs == zfs ']'
++ ZPOOL_VDEV_NAME_PATH=1
++ export ZPOOL_VDEV_NAME_PATH
++ pacman_install 'grub dosfstools'
++ local ERROR=true
++ set +e
++ PACKAGES=('grub dosfstools')
++ IFS=' '
++ local PACKAGES
++ for VARIABLE in {1..5}
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ execute_sudo 'pacman -Syu --noconfirm --needed grub dosfstools'
++ local 'COMMAND=pacman -Syu --noconfirm --needed grub dosfstools'
++ '[' true == true ']'
++ arch-chroot /mnt bash -c 'pacman -Syu --noconfirm --needed grub dosfstools'
:: Synchronizing package databases...
 core downloading...
 extra downloading...
 community downloading...
 archzfs downloading...
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

Packages (2) dosfstools-4.2-1  grub-2:2.06-4

Total Download Size:    6.87 MiB
Total Installed Size:  34.53 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 grub-2:2.06-4-x86_64 downloading...
 dosfstools-4.2-1-x86_64 downloading...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing grub...
:: Generate your bootloader configuration with:
     grub-mkconfig -o /boot/grub/grub.cfg
Optional dependencies for grub
    freetype2: For grub-mkfont usage
    fuse2: For grub-mount usage
    dosfstools: For grub-mkrescue FAT FS and EFI support [pending]
    lzop: For grub-mkrescue LZO support
    efibootmgr: For grub-install EFI support
    libisoburn: Provides xorriso for generating grub rescue iso using grub-mkrescue
    os-prober: To detect other OSes when generating grub.cfg in BIOS systems
    mtools: For grub-mkrescue FAT FS support
installing dosfstools...
:: Running post-transaction hooks...
(1/2) Arming ConditionNeedsUpdate...
(2/2) Updating the info directory file...
++ '[' 0 == 0 ']'
++ local ERROR=false
++ break
++ set -e
++ '[' false == true ']'
++ arch-chroot /mnt sed -i s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/ /etc/default/grub
++ arch-chroot /mnt sed -i 's/#GRUB_SAVEDEFAULT="true"/GRUB_SAVEDEFAULT="true"/' /etc/default/grub
++ arch-chroot /mnt sed -i -E 's/GRUB_CMDLINE_LINUX_DEFAULT="(.*) quiet"/GRUB_CMDLINE_LINUX_DEFAULT="\1"/' /etc/default/grub
++ arch-chroot /mnt sed -i 's/GRUB_CMDLINE_LINUX=""/GRUB_CMDLINE_LINUX="root=ZFS=rpool\/ROOT\/default"/' /etc/default/grub
++ echo ''
++ echo '# alis'
++ echo GRUB_DISABLE_SUBMENU=y
++ '[' bios == uefi ']'
++ '[' bios == bios ']'
++ arch-chroot /mnt grub-install --target=i386-pc --recheck /dev/sda
Installing for i386-pc platform.
Installation finished. No error reported.
++ arch-chroot /mnt grub-mkconfig -o /boot/grub/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-linux
Found initrd image: /boot/initramfs-linux.img
Found fallback initrd image(s) in /boot:  initramfs-linux-fallback.img
Warning: os-prober will not be executed to detect other bootable partitions.
Systems on them will not be added to the GRUB boot configuration.
Check GRUB_DISABLE_OS_PROBER documentation entry.
done
++ '[' true == true ']'
++ echo -n '\EFI\grub\grubx64.efi'
++ arch-chroot /mnt systemctl set-default multi-user.target
Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/multi-user.target.
+ '[' -n bash ']'
+ execute_step custom_shell

[0;96m# custom_shell() step[0m
+ local STEP=custom_shell
+ eval custom_shell
++ custom_shell
++ print_step 'custom_shell()'
++ STEP='custom_shell()'
++ echo ''
++ echo -e '\033[0;96m# custom_shell() step\033[0m'
++ echo ''
++ local CUSTOM_SHELL_PATH=
++ case "$CUSTOM_SHELL" in
++ '[' -n '' ']'
+ '[' -n '' ']'
+ execute_step packages
+ local STEP=packages
+ eval packages
++ packages
++ print_step 'packages()'
++ STEP='packages()'
++ echo ''
++ echo -e '\033[0;96m# packages() step\033[0m'
++ echo ''
++ '[' false == true ']'
+ '[' false == true ']'
+ '[' false == true ']'
+ execute_step systemd_units
+ local STEP=systemd_units
+ eval systemd_units
++ systemd_units
++ UNITS=()
++ IFS=' '
++ local UNITS
++ date -u '+%F %T'


[0;96m# packages() step[0m

+ local 'END_TIMESTAMP=2022-01-28 13:14:14'
+++ date -d '2022-01-28 13:14:14' +%s
+++ date -d '2022-01-28 13:10:12' +%s
++ date -u -d @242 +%T
+ local INSTALLATION_TIME=00:04:02
+ echo -e 'Installation start \033[0;97m2022-01-28 13:10:12\033[0m, end \033[0;97m2022-01-28 13:14:14\033[0m, time \033[0;97m00:04:02\033[0m'
+ execute_step end
+ local STEP=end
+ eval end
++ end
++ echo ''
++ echo -e '\033[0;92mArch Linux installed successfully!\033[0m'
++ echo ''
++ '[' true == true ']'
++ REBOOT=true
++ set +e
++ (( i = 15 ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Installation start [0;97m2022-01-28 13:10:12[0m, end [0;97m2022-01-28 13:14:14[0m, time [0;97m00:04:02[0m

[0;92mArch Linux installed successfully![0m

Rebooting in 15 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 14 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 13 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 12 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 11 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 10 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 10 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 9 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 9 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 8 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 8 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 7 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 7 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 6 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 6 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 5 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 5 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 4 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 4 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 3 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 3 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 2 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 2 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
++ (( i >= 1 ))
++ read -r -s -n 1 -t 1 -p 'Rebooting in 1 seconds... Press Esc key to abort or press R key to reboot now.
' KEY
Rebooting in 1 seconds... Press Esc key to abort or press R key to reboot now.
++ local CODE=142
++ '[' 142 '!=' 0 ']'
++ continue
++ (( i--  ))
Rebooting...

++ (( i >= 1 ))
++ set -e
++ '[' true == true ']'
++ echo Rebooting...
++ echo ''
++ copy_logs
+++ echo ''
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_LUKS_PASSWORD=
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
+++ echo changeme
++ local ESCAPED_ROOT_PASSWORD=changeme
+++ echo changeme
+++ sed 's/[.[\*^$()+?{|]/[\\&]/g'
++ local ESCAPED_USER_PASSWORD=changeme
++ '[' -f alis.conf ']'
++ local SOURCE_FILE=alis.conf
++ local FILE=/mnt/var/log/alis/alis.conf
++ mkdir -p /mnt/var/log/alis
++ cp alis.conf /mnt/var/log/alis/alis.conf
++ chown root:root /mnt/var/log/alis/alis.conf
++ chmod 600 /mnt/var/log/alis/alis.conf
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.conf
++ '[' -f alis.log ']'
++ local SOURCE_FILE=alis.log
++ local FILE=/mnt/var/log/alis/alis.log
++ mkdir -p /mnt/var/log/alis
++ cp alis.log /mnt/var/log/alis/alis.log
++ chown root:root /mnt/var/log/alis/alis.log
++ chmod 600 /mnt/var/log/alis/alis.log
++ '[' -n '' ']'
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -n changeme ']'
++ sed -i 's/changeme/******/g' /mnt/var/log/alis/alis.log
++ '[' -f alis.asciinema ']'
++ do_reboot
++ '[' zfs == zfs ']'
++ zfs umount -a
++ zpool export bpool rpool
++ reboot
